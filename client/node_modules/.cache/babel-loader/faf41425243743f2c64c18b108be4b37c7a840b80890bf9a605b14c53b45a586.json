{"ast":null,"code":"var _jsxFileName = \"/Users/dheerajkumar/Desktop/Collaborative_Editor/client/src/components/Editor.js\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useRef, useState, useCallback } from 'react';\nimport { useParams, useNavigate } from 'react-router-dom';\nimport { io } from 'socket.io-client';\nimport * as Y from 'yjs';\nimport axios from 'axios';\nimport { toast } from 'react-toastify';\nimport { useAuth } from '../context/AuthContext';\nimport './Editor.css';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst API_URL = process.env.REACT_APP_API_URL || 'http://localhost:5000/api';\nconst WS_URL = process.env.REACT_APP_WS_URL || 'http://localhost:5000';\nfunction Editor() {\n  _s();\n  const {\n    documentId\n  } = useParams();\n  const navigate = useNavigate();\n  const {\n    user\n  } = useAuth();\n  const editorRef = useRef(null);\n  const socketRef = useRef(null);\n  const ydocRef = useRef(null);\n  const ytextRef = useRef(null);\n  const [connected, setConnected] = useState(false);\n  const [documentTitle, setDocumentTitle] = useState('Loading...');\n  const [content, setContent] = useState('');\n  const [presence, setPresence] = useState({});\n  const [pendingOperations, setPendingOperations] = useState([]);\n  const [isOffline, setIsOffline] = useState(false);\n  const cursorThrottleRef = useRef(0);\n  const lastCursorRef = useRef({\n    position: 0,\n    selectionStart: 0,\n    selectionEnd: 0\n  });\n  const clientIdRef = useRef(0);\n  const vectorClockRef = useRef({});\n  const isLocalChangeRef = useRef(false);\n  useEffect(() => {\n    fetchDocumentInfo();\n    initializeEditor();\n    return () => {\n      cleanup();\n    };\n  }, [documentId]);\n  const fetchDocumentInfo = async () => {\n    try {\n      const response = await axios.get(`${API_URL}/documents/${documentId}`);\n      setDocumentTitle(response.data.document.title);\n    } catch (error) {\n      console.error('Error fetching document info:', error);\n      toast.error('Failed to load document');\n    }\n  };\n  const initializeEditor = async () => {\n    try {\n      // Initialize Yjs document\n      const ydoc = new Y.Doc();\n      const ytext = ydoc.getText('content');\n      ydocRef.current = ydoc;\n      ytextRef.current = ytext;\n\n      // Initialize WebSocket connection\n      const token = localStorage.getItem('token');\n      const socket = io(WS_URL, {\n        auth: {\n          token\n        },\n        transports: ['websocket'],\n        reconnection: true,\n        reconnectionDelay: 1000,\n        reconnectionAttempts: 5\n      });\n      socketRef.current = socket;\n\n      // Socket event handlers\n      socket.on('connect', () => {\n        setConnected(true);\n        setIsOffline(false);\n        toast.success('Connected');\n        socket.emit('join-document', {\n          documentId\n        });\n      });\n      socket.on('disconnect', () => {\n        setConnected(false);\n        setIsOffline(true);\n        toast.warning('Disconnected. Changes will sync when reconnected.');\n      });\n      socket.on('connect_error', error => {\n        console.error('Connection error:', error);\n        toast.error('Connection failed');\n      });\n      socket.on('document-state', async ({\n        state,\n        version,\n        vectorClock\n      }) => {\n        try {\n          const stateBuffer = Uint8Array.from(atob(state), c => c.charCodeAt(0));\n          Y.applyUpdate(ydoc, stateBuffer);\n          vectorClockRef.current = vectorClock || {};\n\n          // Process pending operations\n          if (pendingOperations.length > 0) {\n            await processPendingOperations();\n          }\n        } catch (error) {\n          console.error('Error applying document state:', error);\n        }\n      });\n      socket.on('document-update', ({\n        update,\n        vectorClock,\n        lamportTimestamp,\n        userId,\n        clientId\n      }) => {\n        try {\n          // Skip if this is our own update (already applied optimistically)\n          if (clientId === clientIdRef.current) {\n            return;\n          }\n          const updateBuffer = Uint8Array.from(atob(update), c => c.charCodeAt(0));\n          Y.applyUpdate(ydoc, updateBuffer);\n          vectorClockRef.current = vectorClock || {};\n        } catch (error) {\n          console.error('Error applying update:', error);\n        }\n      });\n      socket.on('update-ack', ({\n        clientId,\n        vectorClock,\n        lamportTimestamp\n      }) => {\n        // Remove acknowledged operation from pending queue\n        setPendingOperations(prev => prev.filter(op => op.clientId !== clientId));\n        vectorClockRef.current = vectorClock || {};\n      });\n      socket.on('cursor-update', ({\n        userId,\n        username,\n        cursor\n      }) => {\n        setPresence(prev => ({\n          ...prev,\n          [userId]: {\n            ...prev[userId],\n            cursor,\n            username\n          }\n        }));\n      });\n      socket.on('user-joined', ({\n        userId,\n        username,\n        color\n      }) => {\n        setPresence(prev => ({\n          ...prev,\n          [userId]: {\n            username,\n            color,\n            cursor: null\n          }\n        }));\n        toast.info(`${username} joined`);\n      });\n      socket.on('user-left', ({\n        userId,\n        username\n      }) => {\n        setPresence(prev => {\n          const updated = {\n            ...prev\n          };\n          delete updated[userId];\n          return updated;\n        });\n        toast.info(`${username} left`);\n      });\n      socket.on('presence-update', ({\n        users\n      }) => {\n        const presenceMap = {};\n        users.forEach(user => {\n          presenceMap[user.userId] = user;\n        });\n        setPresence(presenceMap);\n      });\n      socket.on('error', ({\n        message\n      }) => {\n        toast.error(message);\n        if (message.includes('Access denied') || message.includes('not found')) {\n          navigate('/documents');\n        }\n      });\n\n      // Yjs text observer - only update if change came from Yjs (not from our own input)\n      ytext.observe(event => {\n        if (!isLocalChangeRef.current) {\n          const text = ytext.toString();\n          setContent(text);\n          // Sync cursor position if needed\n          if (editorRef.current) {\n            const textarea = editorRef.current;\n            const cursorPos = Math.min(textarea.selectionStart, text.length);\n            textarea.setSelectionRange(cursorPos, cursorPos);\n          }\n        }\n        isLocalChangeRef.current = false;\n      });\n\n      // Initial content\n      setContent(ytext.toString());\n    } catch (error) {\n      console.error('Initialization error:', error);\n      toast.error('Failed to initialize editor');\n    }\n  };\n  const processPendingOperations = async () => {\n    var _socketRef$current;\n    if (!((_socketRef$current = socketRef.current) !== null && _socketRef$current !== void 0 && _socketRef$current.connected) || pendingOperations.length === 0) {\n      return;\n    }\n    const operations = [...pendingOperations];\n    setPendingOperations([]);\n    for (const op of operations) {\n      try {\n        socketRef.current.emit('document-update', {\n          documentId,\n          update: op.update,\n          vectorClock: op.vectorClock,\n          clientId: op.clientId\n        });\n      } catch (error) {\n        console.error('Error sending pending operation:', error);\n        setPendingOperations(prev => [...prev, op]);\n      }\n    }\n  };\n  const handleTextChange = useCallback(e => {\n    var _socketRef$current2;\n    if (!ytextRef.current || !ydocRef.current) return;\n    const newValue = e.target.value;\n    const oldValue = ytextRef.current.toString();\n    if (newValue === oldValue) return;\n\n    // Mark as local change to prevent observer from updating\n    isLocalChangeRef.current = true;\n\n    // Calculate diff\n    const diff = calculateDiff(oldValue, newValue);\n\n    // Apply changes to Yjs\n    if (diff.type === 'insert') {\n      ytextRef.current.insert(diff.index, diff.text);\n    } else if (diff.type === 'delete') {\n      ytextRef.current.delete(diff.index, diff.length);\n    } else if (diff.type === 'replace') {\n      ytextRef.current.delete(diff.index, diff.length);\n      ytextRef.current.insert(diff.index, diff.insert);\n    }\n\n    // Send update optimistically\n    const update = Y.encodeStateAsUpdate(ydocRef.current);\n    const clientId = ++clientIdRef.current;\n    const updateBase64 = btoa(String.fromCharCode(...update));\n    if ((_socketRef$current2 = socketRef.current) !== null && _socketRef$current2 !== void 0 && _socketRef$current2.connected) {\n      socketRef.current.emit('document-update', {\n        documentId,\n        update: updateBase64,\n        vectorClock: vectorClockRef.current,\n        clientId\n      });\n\n      // Add to pending operations for ACK tracking\n      setPendingOperations(prev => [...prev, {\n        clientId,\n        update: updateBase64,\n        vectorClock: vectorClockRef.current,\n        timestamp: Date.now()\n      }]);\n    } else {\n      // Queue for offline\n      setPendingOperations(prev => [...prev, {\n        clientId,\n        update: updateBase64,\n        vectorClock: vectorClockRef.current,\n        timestamp: Date.now()\n      }]);\n      setIsOffline(true);\n    }\n  }, [documentId, pendingOperations]);\n  const calculateDiff = (oldText, newText) => {\n    let i = 0;\n    while (i < oldText.length && i < newText.length && oldText[i] === newText[i]) {\n      i++;\n    }\n    let j = oldText.length - 1;\n    let k = newText.length - 1;\n    while (j >= i && k >= i && oldText[j] === newText[k]) {\n      j--;\n      k--;\n    }\n    if (i > j) {\n      // Insertion\n      return {\n        type: 'insert',\n        index: i,\n        text: newText.substring(i, k + 1)\n      };\n    } else if (i > k) {\n      // Deletion\n      return {\n        type: 'delete',\n        index: i,\n        length: j - i + 1\n      };\n    } else {\n      // Replacement\n      return {\n        type: 'replace',\n        index: i,\n        length: j - i + 1,\n        insert: newText.substring(i, k + 1)\n      };\n    }\n  };\n  const handleCursorChange = useCallback(() => {\n    var _socketRef$current3;\n    if (!editorRef.current) return;\n    const textarea = editorRef.current;\n    const position = textarea.selectionStart;\n    const selectionStart = textarea.selectionStart;\n    const selectionEnd = textarea.selectionEnd;\n\n    // Throttle cursor updates (max once per 50ms)\n    const now = Date.now();\n    if (now - cursorThrottleRef.current < 50) {\n      return;\n    }\n    cursorThrottleRef.current = now;\n\n    // Only send if cursor actually changed\n    if (position === lastCursorRef.current.position && selectionStart === lastCursorRef.current.selectionStart && selectionEnd === lastCursorRef.current.selectionEnd) {\n      return;\n    }\n    lastCursorRef.current = {\n      position,\n      selectionStart,\n      selectionEnd\n    };\n    if ((_socketRef$current3 = socketRef.current) !== null && _socketRef$current3 !== void 0 && _socketRef$current3.connected) {\n      socketRef.current.emit('cursor-update', {\n        documentId,\n        cursor: {\n          position,\n          selectionStart,\n          selectionEnd\n        }\n      });\n    }\n  }, [documentId]);\n  const cleanup = () => {\n    if (socketRef.current) {\n      socketRef.current.disconnect();\n      socketRef.current = null;\n    }\n    if (ydocRef.current) {\n      ydocRef.current.destroy();\n      ydocRef.current = null;\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"editor-container\",\n    children: [/*#__PURE__*/_jsxDEV(\"header\", {\n      className: \"editor-header\",\n      children: [/*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: () => navigate('/documents'),\n        className: \"back-btn\",\n        children: \"\\u2190 Back\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 341,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"h1\", {\n        children: documentTitle\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 344,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"editor-status\",\n        children: [/*#__PURE__*/_jsxDEV(\"span\", {\n          className: `status-indicator ${connected ? 'connected' : 'disconnected'}`,\n          children: connected ? '● Connected' : '○ Disconnected'\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 346,\n          columnNumber: 11\n        }, this), Object.keys(presence).length > 0 && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"presence-indicators\",\n          children: Object.entries(presence).map(([userId, data]) => {\n            var _data$username, _data$username$;\n            return /*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"presence-badge\",\n              style: {\n                borderColor: data.color || '#667eea'\n              },\n              title: data.username,\n              children: ((_data$username = data.username) === null || _data$username === void 0 ? void 0 : (_data$username$ = _data$username[0]) === null || _data$username$ === void 0 ? void 0 : _data$username$.toUpperCase()) || 'U'\n            }, userId, false, {\n              fileName: _jsxFileName,\n              lineNumber: 352,\n              columnNumber: 17\n            }, this);\n          })\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 350,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 345,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 340,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"editor-content\",\n      children: /*#__PURE__*/_jsxDEV(\"textarea\", {\n        ref: editorRef,\n        value: content,\n        onChange: handleTextChange,\n        onSelect: handleCursorChange,\n        onKeyUp: handleCursorChange,\n        onMouseUp: handleCursorChange,\n        className: \"editor-textarea\",\n        placeholder: \"Start typing...\",\n        spellCheck: false\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 367,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 366,\n      columnNumber: 7\n    }, this), isOffline && pendingOperations.length > 0 && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"offline-indicator\",\n      children: [pendingOperations.length, \" pending change(s) - will sync when reconnected\"]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 381,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 339,\n    columnNumber: 5\n  }, this);\n}\n_s(Editor, \"C+bqiJA2umkkhP0jOJrS2ekw/Ns=\", false, function () {\n  return [useParams, useNavigate, useAuth];\n});\n_c = Editor;\nexport default Editor;\nvar _c;\n$RefreshReg$(_c, \"Editor\");","map":{"version":3,"names":["React","useEffect","useRef","useState","useCallback","useParams","useNavigate","io","Y","axios","toast","useAuth","jsxDEV","_jsxDEV","API_URL","process","env","REACT_APP_API_URL","WS_URL","REACT_APP_WS_URL","Editor","_s","documentId","navigate","user","editorRef","socketRef","ydocRef","ytextRef","connected","setConnected","documentTitle","setDocumentTitle","content","setContent","presence","setPresence","pendingOperations","setPendingOperations","isOffline","setIsOffline","cursorThrottleRef","lastCursorRef","position","selectionStart","selectionEnd","clientIdRef","vectorClockRef","isLocalChangeRef","fetchDocumentInfo","initializeEditor","cleanup","response","get","data","document","title","error","console","ydoc","Doc","ytext","getText","current","token","localStorage","getItem","socket","auth","transports","reconnection","reconnectionDelay","reconnectionAttempts","on","success","emit","warning","state","version","vectorClock","stateBuffer","Uint8Array","from","atob","c","charCodeAt","applyUpdate","length","processPendingOperations","update","lamportTimestamp","userId","clientId","updateBuffer","prev","filter","op","username","cursor","color","info","updated","users","presenceMap","forEach","message","includes","observe","event","text","toString","textarea","cursorPos","Math","min","setSelectionRange","_socketRef$current","operations","handleTextChange","e","_socketRef$current2","newValue","target","value","oldValue","diff","calculateDiff","type","insert","index","delete","encodeStateAsUpdate","updateBase64","btoa","String","fromCharCode","timestamp","Date","now","oldText","newText","i","j","k","substring","handleCursorChange","_socketRef$current3","disconnect","destroy","className","children","onClick","fileName","_jsxFileName","lineNumber","columnNumber","Object","keys","entries","map","_data$username","_data$username$","style","borderColor","toUpperCase","ref","onChange","onSelect","onKeyUp","onMouseUp","placeholder","spellCheck","_c","$RefreshReg$"],"sources":["/Users/dheerajkumar/Desktop/Collaborative_Editor/client/src/components/Editor.js"],"sourcesContent":["import React, { useEffect, useRef, useState, useCallback } from 'react';\nimport { useParams, useNavigate } from 'react-router-dom';\nimport { io } from 'socket.io-client';\nimport * as Y from 'yjs';\nimport axios from 'axios';\nimport { toast } from 'react-toastify';\nimport { useAuth } from '../context/AuthContext';\nimport './Editor.css';\n\nconst API_URL = process.env.REACT_APP_API_URL || 'http://localhost:5000/api';\nconst WS_URL = process.env.REACT_APP_WS_URL || 'http://localhost:5000';\n\nfunction Editor() {\n  const { documentId } = useParams();\n  const navigate = useNavigate();\n  const { user } = useAuth();\n  const editorRef = useRef(null);\n  const socketRef = useRef(null);\n  const ydocRef = useRef(null);\n  const ytextRef = useRef(null);\n  const [connected, setConnected] = useState(false);\n  const [documentTitle, setDocumentTitle] = useState('Loading...');\n  const [content, setContent] = useState('');\n  const [presence, setPresence] = useState({});\n  const [pendingOperations, setPendingOperations] = useState([]);\n  const [isOffline, setIsOffline] = useState(false);\n  const cursorThrottleRef = useRef(0);\n  const lastCursorRef = useRef({ position: 0, selectionStart: 0, selectionEnd: 0 });\n  const clientIdRef = useRef(0);\n  const vectorClockRef = useRef({});\n  const isLocalChangeRef = useRef(false);\n\n  useEffect(() => {\n    fetchDocumentInfo();\n    initializeEditor();\n    return () => {\n      cleanup();\n    };\n  }, [documentId]);\n\n  const fetchDocumentInfo = async () => {\n    try {\n      const response = await axios.get(`${API_URL}/documents/${documentId}`);\n      setDocumentTitle(response.data.document.title);\n    } catch (error) {\n      console.error('Error fetching document info:', error);\n      toast.error('Failed to load document');\n    }\n  };\n\n  const initializeEditor = async () => {\n    try {\n      // Initialize Yjs document\n      const ydoc = new Y.Doc();\n      const ytext = ydoc.getText('content');\n      ydocRef.current = ydoc;\n      ytextRef.current = ytext;\n\n      // Initialize WebSocket connection\n      const token = localStorage.getItem('token');\n      const socket = io(WS_URL, {\n        auth: { token },\n        transports: ['websocket'],\n        reconnection: true,\n        reconnectionDelay: 1000,\n        reconnectionAttempts: 5,\n      });\n\n      socketRef.current = socket;\n\n      // Socket event handlers\n      socket.on('connect', () => {\n        setConnected(true);\n        setIsOffline(false);\n        toast.success('Connected');\n        socket.emit('join-document', { documentId });\n      });\n\n      socket.on('disconnect', () => {\n        setConnected(false);\n        setIsOffline(true);\n        toast.warning('Disconnected. Changes will sync when reconnected.');\n      });\n\n      socket.on('connect_error', (error) => {\n        console.error('Connection error:', error);\n        toast.error('Connection failed');\n      });\n\n      socket.on('document-state', async ({ state, version, vectorClock }) => {\n        try {\n          const stateBuffer = Uint8Array.from(atob(state), c => c.charCodeAt(0));\n          Y.applyUpdate(ydoc, stateBuffer);\n          vectorClockRef.current = vectorClock || {};\n          \n          // Process pending operations\n          if (pendingOperations.length > 0) {\n            await processPendingOperations();\n          }\n        } catch (error) {\n          console.error('Error applying document state:', error);\n        }\n      });\n\n      socket.on('document-update', ({ update, vectorClock, lamportTimestamp, userId, clientId }) => {\n        try {\n          // Skip if this is our own update (already applied optimistically)\n          if (clientId === clientIdRef.current) {\n            return;\n          }\n\n          const updateBuffer = Uint8Array.from(atob(update), c => c.charCodeAt(0));\n          Y.applyUpdate(ydoc, updateBuffer);\n          vectorClockRef.current = vectorClock || {};\n        } catch (error) {\n          console.error('Error applying update:', error);\n        }\n      });\n\n      socket.on('update-ack', ({ clientId, vectorClock, lamportTimestamp }) => {\n        // Remove acknowledged operation from pending queue\n        setPendingOperations(prev => prev.filter(op => op.clientId !== clientId));\n        vectorClockRef.current = vectorClock || {};\n      });\n\n      socket.on('cursor-update', ({ userId, username, cursor }) => {\n        setPresence(prev => ({\n          ...prev,\n          [userId]: { ...prev[userId], cursor, username },\n        }));\n      });\n\n      socket.on('user-joined', ({ userId, username, color }) => {\n        setPresence(prev => ({\n          ...prev,\n          [userId]: { username, color, cursor: null },\n        }));\n        toast.info(`${username} joined`);\n      });\n\n      socket.on('user-left', ({ userId, username }) => {\n        setPresence(prev => {\n          const updated = { ...prev };\n          delete updated[userId];\n          return updated;\n        });\n        toast.info(`${username} left`);\n      });\n\n      socket.on('presence-update', ({ users }) => {\n        const presenceMap = {};\n        users.forEach(user => {\n          presenceMap[user.userId] = user;\n        });\n        setPresence(presenceMap);\n      });\n\n      socket.on('error', ({ message }) => {\n        toast.error(message);\n        if (message.includes('Access denied') || message.includes('not found')) {\n          navigate('/documents');\n        }\n      });\n\n      // Yjs text observer - only update if change came from Yjs (not from our own input)\n      ytext.observe((event) => {\n        if (!isLocalChangeRef.current) {\n          const text = ytext.toString();\n          setContent(text);\n          // Sync cursor position if needed\n          if (editorRef.current) {\n            const textarea = editorRef.current;\n            const cursorPos = Math.min(textarea.selectionStart, text.length);\n            textarea.setSelectionRange(cursorPos, cursorPos);\n          }\n        }\n        isLocalChangeRef.current = false;\n      });\n\n      // Initial content\n      setContent(ytext.toString());\n\n    } catch (error) {\n      console.error('Initialization error:', error);\n      toast.error('Failed to initialize editor');\n    }\n  };\n\n  const processPendingOperations = async () => {\n    if (!socketRef.current?.connected || pendingOperations.length === 0) {\n      return;\n    }\n\n    const operations = [...pendingOperations];\n    setPendingOperations([]);\n\n    for (const op of operations) {\n      try {\n        socketRef.current.emit('document-update', {\n          documentId,\n          update: op.update,\n          vectorClock: op.vectorClock,\n          clientId: op.clientId,\n        });\n      } catch (error) {\n        console.error('Error sending pending operation:', error);\n        setPendingOperations(prev => [...prev, op]);\n      }\n    }\n  };\n\n  const handleTextChange = useCallback((e) => {\n    if (!ytextRef.current || !ydocRef.current) return;\n\n    const newValue = e.target.value;\n    const oldValue = ytextRef.current.toString();\n    \n    if (newValue === oldValue) return;\n\n    // Mark as local change to prevent observer from updating\n    isLocalChangeRef.current = true;\n    \n    // Calculate diff\n    const diff = calculateDiff(oldValue, newValue);\n    \n    // Apply changes to Yjs\n    if (diff.type === 'insert') {\n      ytextRef.current.insert(diff.index, diff.text);\n    } else if (diff.type === 'delete') {\n      ytextRef.current.delete(diff.index, diff.length);\n    } else if (diff.type === 'replace') {\n      ytextRef.current.delete(diff.index, diff.length);\n      ytextRef.current.insert(diff.index, diff.insert);\n    }\n\n    // Send update optimistically\n    const update = Y.encodeStateAsUpdate(ydocRef.current);\n    const clientId = ++clientIdRef.current;\n    const updateBase64 = btoa(String.fromCharCode(...update));\n\n    if (socketRef.current?.connected) {\n      socketRef.current.emit('document-update', {\n        documentId,\n        update: updateBase64,\n        vectorClock: vectorClockRef.current,\n        clientId,\n      });\n\n      // Add to pending operations for ACK tracking\n      setPendingOperations(prev => [...prev, {\n        clientId,\n        update: updateBase64,\n        vectorClock: vectorClockRef.current,\n        timestamp: Date.now(),\n      }]);\n    } else {\n      // Queue for offline\n      setPendingOperations(prev => [...prev, {\n        clientId,\n        update: updateBase64,\n        vectorClock: vectorClockRef.current,\n        timestamp: Date.now(),\n      }]);\n      setIsOffline(true);\n    }\n  }, [documentId, pendingOperations]);\n\n  const calculateDiff = (oldText, newText) => {\n    let i = 0;\n    while (i < oldText.length && i < newText.length && oldText[i] === newText[i]) {\n      i++;\n    }\n\n    let j = oldText.length - 1;\n    let k = newText.length - 1;\n    while (j >= i && k >= i && oldText[j] === newText[k]) {\n      j--;\n      k--;\n    }\n\n    if (i > j) {\n      // Insertion\n      return { type: 'insert', index: i, text: newText.substring(i, k + 1) };\n    } else if (i > k) {\n      // Deletion\n      return { type: 'delete', index: i, length: j - i + 1 };\n    } else {\n      // Replacement\n      return { type: 'replace', index: i, length: j - i + 1, insert: newText.substring(i, k + 1) };\n    }\n  };\n\n  const handleCursorChange = useCallback(() => {\n    if (!editorRef.current) return;\n\n    const textarea = editorRef.current;\n    const position = textarea.selectionStart;\n    const selectionStart = textarea.selectionStart;\n    const selectionEnd = textarea.selectionEnd;\n\n    // Throttle cursor updates (max once per 50ms)\n    const now = Date.now();\n    if (now - cursorThrottleRef.current < 50) {\n      return;\n    }\n    cursorThrottleRef.current = now;\n\n    // Only send if cursor actually changed\n    if (\n      position === lastCursorRef.current.position &&\n      selectionStart === lastCursorRef.current.selectionStart &&\n      selectionEnd === lastCursorRef.current.selectionEnd\n    ) {\n      return;\n    }\n\n    lastCursorRef.current = { position, selectionStart, selectionEnd };\n\n    if (socketRef.current?.connected) {\n      socketRef.current.emit('cursor-update', {\n        documentId,\n        cursor: { position, selectionStart, selectionEnd },\n      });\n    }\n  }, [documentId]);\n\n  const cleanup = () => {\n    if (socketRef.current) {\n      socketRef.current.disconnect();\n      socketRef.current = null;\n    }\n    if (ydocRef.current) {\n      ydocRef.current.destroy();\n      ydocRef.current = null;\n    }\n  };\n\n  return (\n    <div className=\"editor-container\">\n      <header className=\"editor-header\">\n        <button onClick={() => navigate('/documents')} className=\"back-btn\">\n          ← Back\n        </button>\n        <h1>{documentTitle}</h1>\n        <div className=\"editor-status\">\n          <span className={`status-indicator ${connected ? 'connected' : 'disconnected'}`}>\n            {connected ? '● Connected' : '○ Disconnected'}\n          </span>\n          {Object.keys(presence).length > 0 && (\n            <div className=\"presence-indicators\">\n              {Object.entries(presence).map(([userId, data]) => (\n                <span\n                  key={userId}\n                  className=\"presence-badge\"\n                  style={{ borderColor: data.color || '#667eea' }}\n                  title={data.username}\n                >\n                  {data.username?.[0]?.toUpperCase() || 'U'}\n                </span>\n              ))}\n            </div>\n          )}\n        </div>\n      </header>\n\n      <div className=\"editor-content\">\n        <textarea\n          ref={editorRef}\n          value={content}\n          onChange={handleTextChange}\n          onSelect={handleCursorChange}\n          onKeyUp={handleCursorChange}\n          onMouseUp={handleCursorChange}\n          className=\"editor-textarea\"\n          placeholder=\"Start typing...\"\n          spellCheck={false}\n        />\n      </div>\n\n      {isOffline && pendingOperations.length > 0 && (\n        <div className=\"offline-indicator\">\n          {pendingOperations.length} pending change(s) - will sync when reconnected\n        </div>\n      )}\n    </div>\n  );\n}\n\nexport default Editor;\n\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}