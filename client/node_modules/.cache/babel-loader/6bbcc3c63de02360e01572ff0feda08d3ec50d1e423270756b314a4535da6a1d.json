{"ast":null,"code":"var _jsxFileName = \"/Users/dheerajkumar/Desktop/Collaborative_Editor/client/src/components/Editor.js\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useRef, useState, useCallback } from 'react';\nimport { useParams, useNavigate } from 'react-router-dom';\nimport { io } from 'socket.io-client';\nimport * as Y from 'yjs';\nimport axios from 'axios';\nimport { toast } from 'react-toastify';\nimport DocumentSettings from './DocumentSettings';\nimport './Editor.css';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst API_URL = process.env.REACT_APP_API_URL || 'http://localhost:5001/api';\nconst WS_URL = process.env.REACT_APP_WS_URL || 'http://localhost:5001';\nfunction Editor() {\n  _s();\n  const {\n    documentId\n  } = useParams();\n  const navigate = useNavigate();\n  const editorRef = useRef(null);\n  const socketRef = useRef(null);\n  const ydocRef = useRef(null);\n  const ytextRef = useRef(null);\n  const [connected, setConnected] = useState(false);\n  const [documentTitle, setDocumentTitle] = useState('Loading...');\n  const [content, setContent] = useState('');\n  const [presence, setPresence] = useState({});\n  const [pendingOperations, setPendingOperations] = useState([]);\n  const [isOffline, setIsOffline] = useState(false);\n  const [showSettings, setShowSettings] = useState(false);\n  const [userRole, setUserRole] = useState('viewer');\n  const cursorThrottleRef = useRef(0);\n  const lastCursorRef = useRef({\n    position: 0,\n    selectionStart: 0,\n    selectionEnd: 0\n  });\n  const clientIdRef = useRef(0);\n  const vectorClockRef = useRef({});\n  const isLocalChangeRef = useRef(false);\n  useEffect(() => {\n    fetchDocumentInfo();\n    initializeEditor();\n    return () => {\n      cleanup();\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [documentId]);\n  const fetchDocumentInfo = async () => {\n    try {\n      const response = await axios.get(`${API_URL}/documents/${documentId}`);\n      const doc = response.data.document;\n      setDocumentTitle(doc.title);\n\n      // Determine user role by checking if current user is owner or has access\n      try {\n        var _doc$owner, _doc$owner2;\n        const meResponse = await axios.get(`${API_URL}/auth/me`);\n        const currentUserId = meResponse.data.user.id;\n        if (((_doc$owner = doc.owner) === null || _doc$owner === void 0 ? void 0 : _doc$owner.id) === currentUserId || ((_doc$owner2 = doc.owner) === null || _doc$owner2 === void 0 ? void 0 : _doc$owner2._id) === currentUserId) {\n          setUserRole('owner');\n        } else {\n          var _doc$accessControl;\n          const access = (_doc$accessControl = doc.accessControl) === null || _doc$accessControl === void 0 ? void 0 : _doc$accessControl.find(ac => {\n            var _ac$user, _ac$user2;\n            return ((_ac$user = ac.user) === null || _ac$user === void 0 ? void 0 : _ac$user.id) === currentUserId || ((_ac$user2 = ac.user) === null || _ac$user2 === void 0 ? void 0 : _ac$user2._id) === currentUserId;\n          });\n          setUserRole((access === null || access === void 0 ? void 0 : access.role) || 'viewer');\n        }\n      } catch (authError) {\n        // If we can't get user info, default to viewer\n        setUserRole('viewer');\n      }\n    } catch (error) {\n      console.error('Error fetching document info:', error);\n      toast.error('Failed to load document');\n    }\n  };\n  const initializeEditor = async () => {\n    try {\n      // Initialize Yjs document\n      const ydoc = new Y.Doc();\n      const ytext = ydoc.getText('content');\n      ydocRef.current = ydoc;\n      ytextRef.current = ytext;\n\n      // Initialize WebSocket connection\n      const token = localStorage.getItem('token');\n      const socket = io(WS_URL, {\n        auth: {\n          token\n        },\n        transports: ['websocket'],\n        reconnection: true,\n        reconnectionDelay: 1000,\n        reconnectionAttempts: 5\n      });\n      socketRef.current = socket;\n\n      // Socket event handlers\n      socket.on('connect', () => {\n        setConnected(true);\n        setIsOffline(false);\n        toast.success('Connected');\n        socket.emit('join-document', {\n          documentId\n        });\n      });\n      socket.on('disconnect', () => {\n        setConnected(false);\n        setIsOffline(true);\n        toast.warning('Disconnected. Changes will sync when reconnected.');\n      });\n      socket.on('connect_error', error => {\n        console.error('Connection error:', error);\n        toast.error('Connection failed');\n      });\n      socket.on('document-state', async ({\n        state,\n        version,\n        vectorClock\n      }) => {\n        try {\n          const stateBuffer = Uint8Array.from(atob(state), c => c.charCodeAt(0));\n          Y.applyUpdate(ydoc, stateBuffer);\n          vectorClockRef.current = vectorClock || {};\n\n          // Process pending operations\n          if (pendingOperations.length > 0) {\n            await processPendingOperations();\n          }\n        } catch (error) {\n          console.error('Error applying document state:', error);\n        }\n      });\n      socket.on('document-update', ({\n        update,\n        vectorClock,\n        lamportTimestamp,\n        userId,\n        clientId\n      }) => {\n        try {\n          // Skip if this is our own update (already applied optimistically)\n          if (clientId === clientIdRef.current) {\n            return;\n          }\n          const updateBuffer = Uint8Array.from(atob(update), c => c.charCodeAt(0));\n          Y.applyUpdate(ydoc, updateBuffer);\n          vectorClockRef.current = vectorClock || {};\n        } catch (error) {\n          console.error('Error applying update:', error);\n        }\n      });\n      socket.on('update-ack', ({\n        clientId,\n        vectorClock,\n        lamportTimestamp\n      }) => {\n        // Remove acknowledged operation from pending queue\n        setPendingOperations(prev => prev.filter(op => op.clientId !== clientId));\n        vectorClockRef.current = vectorClock || {};\n      });\n      socket.on('cursor-update', ({\n        userId,\n        username,\n        cursor\n      }) => {\n        setPresence(prev => ({\n          ...prev,\n          [userId]: {\n            ...prev[userId],\n            cursor,\n            username\n          }\n        }));\n      });\n      socket.on('user-joined', ({\n        userId,\n        username,\n        color\n      }) => {\n        setPresence(prev => ({\n          ...prev,\n          [userId]: {\n            username,\n            color,\n            cursor: null\n          }\n        }));\n        toast.info(`${username} joined`);\n      });\n      socket.on('user-left', ({\n        userId,\n        username\n      }) => {\n        setPresence(prev => {\n          const updated = {\n            ...prev\n          };\n          delete updated[userId];\n          return updated;\n        });\n        toast.info(`${username} left`);\n      });\n      socket.on('presence-update', ({\n        users\n      }) => {\n        const presenceMap = {};\n        users.forEach(user => {\n          presenceMap[user.userId] = user;\n        });\n        setPresence(presenceMap);\n      });\n      socket.on('error', ({\n        message\n      }) => {\n        toast.error(message);\n        if (message.includes('Access denied') || message.includes('not found')) {\n          navigate('/documents');\n        }\n      });\n\n      // Yjs text observer - only update if change came from Yjs (not from our own input)\n      ytext.observe(event => {\n        if (!isLocalChangeRef.current) {\n          const text = ytext.toString();\n          setContent(text);\n          // Sync cursor position if needed\n          if (editorRef.current) {\n            const textarea = editorRef.current;\n            const cursorPos = Math.min(textarea.selectionStart, text.length);\n            textarea.setSelectionRange(cursorPos, cursorPos);\n          }\n        }\n        isLocalChangeRef.current = false;\n      });\n\n      // Initial content\n      setContent(ytext.toString());\n    } catch (error) {\n      console.error('Initialization error:', error);\n      toast.error('Failed to initialize editor');\n    }\n  };\n  const processPendingOperations = async () => {\n    var _socketRef$current;\n    if (!((_socketRef$current = socketRef.current) !== null && _socketRef$current !== void 0 && _socketRef$current.connected) || pendingOperations.length === 0) {\n      return;\n    }\n    const operations = [...pendingOperations];\n    setPendingOperations([]);\n    for (const op of operations) {\n      try {\n        socketRef.current.emit('document-update', {\n          documentId,\n          update: op.update,\n          vectorClock: op.vectorClock,\n          clientId: op.clientId\n        });\n      } catch (error) {\n        console.error('Error sending pending operation:', error);\n        setPendingOperations(prev => [...prev, op]);\n      }\n    }\n  };\n  const handleTextChange = useCallback(e => {\n    var _socketRef$current2;\n    if (!ytextRef.current || !ydocRef.current) return;\n    const newValue = e.target.value;\n    const oldValue = ytextRef.current.toString();\n    if (newValue === oldValue) return;\n\n    // Mark as local change to prevent observer from updating\n    isLocalChangeRef.current = true;\n\n    // Calculate diff\n    const diff = calculateDiff(oldValue, newValue);\n\n    // Apply changes to Yjs\n    if (diff.type === 'insert') {\n      ytextRef.current.insert(diff.index, diff.text);\n    } else if (diff.type === 'delete') {\n      ytextRef.current.delete(diff.index, diff.length);\n    } else if (diff.type === 'replace') {\n      ytextRef.current.delete(diff.index, diff.length);\n      ytextRef.current.insert(diff.index, diff.insert);\n    }\n\n    // Send update optimistically\n    const update = Y.encodeStateAsUpdate(ydocRef.current);\n    const clientId = ++clientIdRef.current;\n    const updateBase64 = btoa(String.fromCharCode(...update));\n    if ((_socketRef$current2 = socketRef.current) !== null && _socketRef$current2 !== void 0 && _socketRef$current2.connected) {\n      socketRef.current.emit('document-update', {\n        documentId,\n        update: updateBase64,\n        vectorClock: vectorClockRef.current,\n        clientId\n      });\n\n      // Add to pending operations for ACK tracking\n      setPendingOperations(prev => [...prev, {\n        clientId,\n        update: updateBase64,\n        vectorClock: vectorClockRef.current,\n        timestamp: Date.now()\n      }]);\n    } else {\n      // Queue for offline\n      setPendingOperations(prev => [...prev, {\n        clientId,\n        update: updateBase64,\n        vectorClock: vectorClockRef.current,\n        timestamp: Date.now()\n      }]);\n      setIsOffline(true);\n    }\n  }, [documentId]);\n  const calculateDiff = (oldText, newText) => {\n    let i = 0;\n    while (i < oldText.length && i < newText.length && oldText[i] === newText[i]) {\n      i++;\n    }\n    let j = oldText.length - 1;\n    let k = newText.length - 1;\n    while (j >= i && k >= i && oldText[j] === newText[k]) {\n      j--;\n      k--;\n    }\n    if (i > j) {\n      // Insertion\n      return {\n        type: 'insert',\n        index: i,\n        text: newText.substring(i, k + 1)\n      };\n    } else if (i > k) {\n      // Deletion\n      return {\n        type: 'delete',\n        index: i,\n        length: j - i + 1\n      };\n    } else {\n      // Replacement\n      return {\n        type: 'replace',\n        index: i,\n        length: j - i + 1,\n        insert: newText.substring(i, k + 1)\n      };\n    }\n  };\n  const handleCursorChange = useCallback(() => {\n    var _socketRef$current3;\n    if (!editorRef.current) return;\n    const textarea = editorRef.current;\n    const position = textarea.selectionStart;\n    const selectionStart = textarea.selectionStart;\n    const selectionEnd = textarea.selectionEnd;\n\n    // Throttle cursor updates (max once per 50ms)\n    const now = Date.now();\n    if (now - cursorThrottleRef.current < 50) {\n      return;\n    }\n    cursorThrottleRef.current = now;\n\n    // Only send if cursor actually changed\n    if (position === lastCursorRef.current.position && selectionStart === lastCursorRef.current.selectionStart && selectionEnd === lastCursorRef.current.selectionEnd) {\n      return;\n    }\n    lastCursorRef.current = {\n      position,\n      selectionStart,\n      selectionEnd\n    };\n    if ((_socketRef$current3 = socketRef.current) !== null && _socketRef$current3 !== void 0 && _socketRef$current3.connected) {\n      socketRef.current.emit('cursor-update', {\n        documentId,\n        cursor: {\n          position,\n          selectionStart,\n          selectionEnd\n        }\n      });\n    }\n  }, [documentId]);\n  const cleanup = () => {\n    if (socketRef.current) {\n      socketRef.current.disconnect();\n      socketRef.current = null;\n    }\n    if (ydocRef.current) {\n      ydocRef.current.destroy();\n      ydocRef.current = null;\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"editor-container\",\n    children: [/*#__PURE__*/_jsxDEV(\"header\", {\n      className: \"editor-header\",\n      children: [/*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: () => navigate('/documents'),\n        className: \"back-btn\",\n        children: \"\\u2190 Back\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 362,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"h1\", {\n        children: documentTitle\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 365,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"header-actions\",\n        children: /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: () => setShowSettings(true),\n          className: \"settings-btn\",\n          children: \"\\u2699\\uFE0F Settings\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 367,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 366,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"editor-status\",\n        children: [/*#__PURE__*/_jsxDEV(\"span\", {\n          className: `status-indicator ${connected ? 'connected' : 'disconnected'}`,\n          children: connected ? '● Connected' : '○ Disconnected'\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 372,\n          columnNumber: 11\n        }, this), Object.keys(presence).length > 0 && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"presence-indicators\",\n          children: Object.entries(presence).map(([userId, data]) => {\n            var _data$username, _data$username$;\n            return /*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"presence-badge\",\n              style: {\n                borderColor: data.color || '#667eea'\n              },\n              title: data.username,\n              children: ((_data$username = data.username) === null || _data$username === void 0 ? void 0 : (_data$username$ = _data$username[0]) === null || _data$username$ === void 0 ? void 0 : _data$username$.toUpperCase()) || 'U'\n            }, userId, false, {\n              fileName: _jsxFileName,\n              lineNumber: 378,\n              columnNumber: 17\n            }, this);\n          })\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 376,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 371,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 361,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"editor-content\",\n      children: /*#__PURE__*/_jsxDEV(\"textarea\", {\n        ref: editorRef,\n        value: content,\n        onChange: handleTextChange,\n        onSelect: handleCursorChange,\n        onKeyUp: handleCursorChange,\n        onMouseUp: handleCursorChange,\n        className: \"editor-textarea\",\n        placeholder: \"Start typing...\",\n        spellCheck: false\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 393,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 392,\n      columnNumber: 7\n    }, this), isOffline && pendingOperations.length > 0 && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"offline-indicator\",\n      children: [pendingOperations.length, \" pending change(s) - will sync when reconnected\"]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 407,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(DocumentSettings, {\n      documentId: documentId,\n      isOpen: showSettings,\n      onClose: () => setShowSettings(false),\n      userRole: userRole,\n      onUpdate: fetchDocumentInfo\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 412,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 360,\n    columnNumber: 5\n  }, this);\n}\n_s(Editor, \"MSgjWhk+AinUYd6g5cPuy1AzMMo=\", false, function () {\n  return [useParams, useNavigate];\n});\n_c = Editor;\nexport default Editor;\nvar _c;\n$RefreshReg$(_c, \"Editor\");","map":{"version":3,"names":["React","useEffect","useRef","useState","useCallback","useParams","useNavigate","io","Y","axios","toast","DocumentSettings","jsxDEV","_jsxDEV","API_URL","process","env","REACT_APP_API_URL","WS_URL","REACT_APP_WS_URL","Editor","_s","documentId","navigate","editorRef","socketRef","ydocRef","ytextRef","connected","setConnected","documentTitle","setDocumentTitle","content","setContent","presence","setPresence","pendingOperations","setPendingOperations","isOffline","setIsOffline","showSettings","setShowSettings","userRole","setUserRole","cursorThrottleRef","lastCursorRef","position","selectionStart","selectionEnd","clientIdRef","vectorClockRef","isLocalChangeRef","fetchDocumentInfo","initializeEditor","cleanup","response","get","doc","data","document","title","_doc$owner","_doc$owner2","meResponse","currentUserId","user","id","owner","_id","_doc$accessControl","access","accessControl","find","ac","_ac$user","_ac$user2","role","authError","error","console","ydoc","Doc","ytext","getText","current","token","localStorage","getItem","socket","auth","transports","reconnection","reconnectionDelay","reconnectionAttempts","on","success","emit","warning","state","version","vectorClock","stateBuffer","Uint8Array","from","atob","c","charCodeAt","applyUpdate","length","processPendingOperations","update","lamportTimestamp","userId","clientId","updateBuffer","prev","filter","op","username","cursor","color","info","updated","users","presenceMap","forEach","message","includes","observe","event","text","toString","textarea","cursorPos","Math","min","setSelectionRange","_socketRef$current","operations","handleTextChange","e","_socketRef$current2","newValue","target","value","oldValue","diff","calculateDiff","type","insert","index","delete","encodeStateAsUpdate","updateBase64","btoa","String","fromCharCode","timestamp","Date","now","oldText","newText","i","j","k","substring","handleCursorChange","_socketRef$current3","disconnect","destroy","className","children","onClick","fileName","_jsxFileName","lineNumber","columnNumber","Object","keys","entries","map","_data$username","_data$username$","style","borderColor","toUpperCase","ref","onChange","onSelect","onKeyUp","onMouseUp","placeholder","spellCheck","isOpen","onClose","onUpdate","_c","$RefreshReg$"],"sources":["/Users/dheerajkumar/Desktop/Collaborative_Editor/client/src/components/Editor.js"],"sourcesContent":["import React, { useEffect, useRef, useState, useCallback } from 'react';\nimport { useParams, useNavigate } from 'react-router-dom';\nimport { io } from 'socket.io-client';\nimport * as Y from 'yjs';\nimport axios from 'axios';\nimport { toast } from 'react-toastify';\nimport DocumentSettings from './DocumentSettings';\nimport './Editor.css';\n\nconst API_URL = process.env.REACT_APP_API_URL || 'http://localhost:5001/api';\nconst WS_URL = process.env.REACT_APP_WS_URL || 'http://localhost:5001';\n\nfunction Editor() {\n  const { documentId } = useParams();\n  const navigate = useNavigate();\n  const editorRef = useRef(null);\n  const socketRef = useRef(null);\n  const ydocRef = useRef(null);\n  const ytextRef = useRef(null);\n  const [connected, setConnected] = useState(false);\n  const [documentTitle, setDocumentTitle] = useState('Loading...');\n  const [content, setContent] = useState('');\n  const [presence, setPresence] = useState({});\n  const [pendingOperations, setPendingOperations] = useState([]);\n  const [isOffline, setIsOffline] = useState(false);\n  const [showSettings, setShowSettings] = useState(false);\n  const [userRole, setUserRole] = useState('viewer');\n  const cursorThrottleRef = useRef(0);\n  const lastCursorRef = useRef({ position: 0, selectionStart: 0, selectionEnd: 0 });\n  const clientIdRef = useRef(0);\n  const vectorClockRef = useRef({});\n  const isLocalChangeRef = useRef(false);\n\n  useEffect(() => {\n    fetchDocumentInfo();\n    initializeEditor();\n    return () => {\n      cleanup();\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [documentId]);\n\n  const fetchDocumentInfo = async () => {\n    try {\n      const response = await axios.get(`${API_URL}/documents/${documentId}`);\n      const doc = response.data.document;\n      setDocumentTitle(doc.title);\n      \n      // Determine user role by checking if current user is owner or has access\n      try {\n        const meResponse = await axios.get(`${API_URL}/auth/me`);\n        const currentUserId = meResponse.data.user.id;\n        \n        if (doc.owner?.id === currentUserId || doc.owner?._id === currentUserId) {\n          setUserRole('owner');\n        } else {\n          const access = doc.accessControl?.find(\n            ac => ac.user?.id === currentUserId || ac.user?._id === currentUserId\n          );\n          setUserRole(access?.role || 'viewer');\n        }\n      } catch (authError) {\n        // If we can't get user info, default to viewer\n        setUserRole('viewer');\n      }\n    } catch (error) {\n      console.error('Error fetching document info:', error);\n      toast.error('Failed to load document');\n    }\n  };\n\n  const initializeEditor = async () => {\n    try {\n      // Initialize Yjs document\n      const ydoc = new Y.Doc();\n      const ytext = ydoc.getText('content');\n      ydocRef.current = ydoc;\n      ytextRef.current = ytext;\n\n      // Initialize WebSocket connection\n      const token = localStorage.getItem('token');\n      const socket = io(WS_URL, {\n        auth: { token },\n        transports: ['websocket'],\n        reconnection: true,\n        reconnectionDelay: 1000,\n        reconnectionAttempts: 5,\n      });\n\n      socketRef.current = socket;\n\n      // Socket event handlers\n      socket.on('connect', () => {\n        setConnected(true);\n        setIsOffline(false);\n        toast.success('Connected');\n        socket.emit('join-document', { documentId });\n      });\n\n      socket.on('disconnect', () => {\n        setConnected(false);\n        setIsOffline(true);\n        toast.warning('Disconnected. Changes will sync when reconnected.');\n      });\n\n      socket.on('connect_error', (error) => {\n        console.error('Connection error:', error);\n        toast.error('Connection failed');\n      });\n\n      socket.on('document-state', async ({ state, version, vectorClock }) => {\n        try {\n          const stateBuffer = Uint8Array.from(atob(state), c => c.charCodeAt(0));\n          Y.applyUpdate(ydoc, stateBuffer);\n          vectorClockRef.current = vectorClock || {};\n          \n          // Process pending operations\n          if (pendingOperations.length > 0) {\n            await processPendingOperations();\n          }\n        } catch (error) {\n          console.error('Error applying document state:', error);\n        }\n      });\n\n      socket.on('document-update', ({ update, vectorClock, lamportTimestamp, userId, clientId }) => {\n        try {\n          // Skip if this is our own update (already applied optimistically)\n          if (clientId === clientIdRef.current) {\n            return;\n          }\n\n          const updateBuffer = Uint8Array.from(atob(update), c => c.charCodeAt(0));\n          Y.applyUpdate(ydoc, updateBuffer);\n          vectorClockRef.current = vectorClock || {};\n        } catch (error) {\n          console.error('Error applying update:', error);\n        }\n      });\n\n      socket.on('update-ack', ({ clientId, vectorClock, lamportTimestamp }) => {\n        // Remove acknowledged operation from pending queue\n        setPendingOperations(prev => prev.filter(op => op.clientId !== clientId));\n        vectorClockRef.current = vectorClock || {};\n      });\n\n      socket.on('cursor-update', ({ userId, username, cursor }) => {\n        setPresence(prev => ({\n          ...prev,\n          [userId]: { ...prev[userId], cursor, username },\n        }));\n      });\n\n      socket.on('user-joined', ({ userId, username, color }) => {\n        setPresence(prev => ({\n          ...prev,\n          [userId]: { username, color, cursor: null },\n        }));\n        toast.info(`${username} joined`);\n      });\n\n      socket.on('user-left', ({ userId, username }) => {\n        setPresence(prev => {\n          const updated = { ...prev };\n          delete updated[userId];\n          return updated;\n        });\n        toast.info(`${username} left`);\n      });\n\n      socket.on('presence-update', ({ users }) => {\n        const presenceMap = {};\n        users.forEach(user => {\n          presenceMap[user.userId] = user;\n        });\n        setPresence(presenceMap);\n      });\n\n      socket.on('error', ({ message }) => {\n        toast.error(message);\n        if (message.includes('Access denied') || message.includes('not found')) {\n          navigate('/documents');\n        }\n      });\n\n      // Yjs text observer - only update if change came from Yjs (not from our own input)\n      ytext.observe((event) => {\n        if (!isLocalChangeRef.current) {\n          const text = ytext.toString();\n          setContent(text);\n          // Sync cursor position if needed\n          if (editorRef.current) {\n            const textarea = editorRef.current;\n            const cursorPos = Math.min(textarea.selectionStart, text.length);\n            textarea.setSelectionRange(cursorPos, cursorPos);\n          }\n        }\n        isLocalChangeRef.current = false;\n      });\n\n      // Initial content\n      setContent(ytext.toString());\n\n    } catch (error) {\n      console.error('Initialization error:', error);\n      toast.error('Failed to initialize editor');\n    }\n  };\n\n  const processPendingOperations = async () => {\n    if (!socketRef.current?.connected || pendingOperations.length === 0) {\n      return;\n    }\n\n    const operations = [...pendingOperations];\n    setPendingOperations([]);\n\n    for (const op of operations) {\n      try {\n        socketRef.current.emit('document-update', {\n          documentId,\n          update: op.update,\n          vectorClock: op.vectorClock,\n          clientId: op.clientId,\n        });\n      } catch (error) {\n        console.error('Error sending pending operation:', error);\n        setPendingOperations(prev => [...prev, op]);\n      }\n    }\n  };\n\n  const handleTextChange = useCallback((e) => {\n    if (!ytextRef.current || !ydocRef.current) return;\n\n    const newValue = e.target.value;\n    const oldValue = ytextRef.current.toString();\n    \n    if (newValue === oldValue) return;\n\n    // Mark as local change to prevent observer from updating\n    isLocalChangeRef.current = true;\n    \n    // Calculate diff\n    const diff = calculateDiff(oldValue, newValue);\n    \n    // Apply changes to Yjs\n    if (diff.type === 'insert') {\n      ytextRef.current.insert(diff.index, diff.text);\n    } else if (diff.type === 'delete') {\n      ytextRef.current.delete(diff.index, diff.length);\n    } else if (diff.type === 'replace') {\n      ytextRef.current.delete(diff.index, diff.length);\n      ytextRef.current.insert(diff.index, diff.insert);\n    }\n\n    // Send update optimistically\n    const update = Y.encodeStateAsUpdate(ydocRef.current);\n    const clientId = ++clientIdRef.current;\n    const updateBase64 = btoa(String.fromCharCode(...update));\n\n    if (socketRef.current?.connected) {\n      socketRef.current.emit('document-update', {\n        documentId,\n        update: updateBase64,\n        vectorClock: vectorClockRef.current,\n        clientId,\n      });\n\n      // Add to pending operations for ACK tracking\n      setPendingOperations(prev => [...prev, {\n        clientId,\n        update: updateBase64,\n        vectorClock: vectorClockRef.current,\n        timestamp: Date.now(),\n      }]);\n    } else {\n      // Queue for offline\n      setPendingOperations(prev => [...prev, {\n        clientId,\n        update: updateBase64,\n        vectorClock: vectorClockRef.current,\n        timestamp: Date.now(),\n      }]);\n      setIsOffline(true);\n    }\n  }, [documentId]);\n\n  const calculateDiff = (oldText, newText) => {\n    let i = 0;\n    while (i < oldText.length && i < newText.length && oldText[i] === newText[i]) {\n      i++;\n    }\n\n    let j = oldText.length - 1;\n    let k = newText.length - 1;\n    while (j >= i && k >= i && oldText[j] === newText[k]) {\n      j--;\n      k--;\n    }\n\n    if (i > j) {\n      // Insertion\n      return { type: 'insert', index: i, text: newText.substring(i, k + 1) };\n    } else if (i > k) {\n      // Deletion\n      return { type: 'delete', index: i, length: j - i + 1 };\n    } else {\n      // Replacement\n      return { type: 'replace', index: i, length: j - i + 1, insert: newText.substring(i, k + 1) };\n    }\n  };\n\n  const handleCursorChange = useCallback(() => {\n    if (!editorRef.current) return;\n\n    const textarea = editorRef.current;\n    const position = textarea.selectionStart;\n    const selectionStart = textarea.selectionStart;\n    const selectionEnd = textarea.selectionEnd;\n\n    // Throttle cursor updates (max once per 50ms)\n    const now = Date.now();\n    if (now - cursorThrottleRef.current < 50) {\n      return;\n    }\n    cursorThrottleRef.current = now;\n\n    // Only send if cursor actually changed\n    if (\n      position === lastCursorRef.current.position &&\n      selectionStart === lastCursorRef.current.selectionStart &&\n      selectionEnd === lastCursorRef.current.selectionEnd\n    ) {\n      return;\n    }\n\n    lastCursorRef.current = { position, selectionStart, selectionEnd };\n\n    if (socketRef.current?.connected) {\n      socketRef.current.emit('cursor-update', {\n        documentId,\n        cursor: { position, selectionStart, selectionEnd },\n      });\n    }\n  }, [documentId]);\n\n  const cleanup = () => {\n    if (socketRef.current) {\n      socketRef.current.disconnect();\n      socketRef.current = null;\n    }\n    if (ydocRef.current) {\n      ydocRef.current.destroy();\n      ydocRef.current = null;\n    }\n  };\n\n  return (\n    <div className=\"editor-container\">\n      <header className=\"editor-header\">\n        <button onClick={() => navigate('/documents')} className=\"back-btn\">\n          ← Back\n        </button>\n        <h1>{documentTitle}</h1>\n        <div className=\"header-actions\">\n          <button onClick={() => setShowSettings(true)} className=\"settings-btn\">\n            ⚙️ Settings\n          </button>\n        </div>\n        <div className=\"editor-status\">\n          <span className={`status-indicator ${connected ? 'connected' : 'disconnected'}`}>\n            {connected ? '● Connected' : '○ Disconnected'}\n          </span>\n          {Object.keys(presence).length > 0 && (\n            <div className=\"presence-indicators\">\n              {Object.entries(presence).map(([userId, data]) => (\n                <span\n                  key={userId}\n                  className=\"presence-badge\"\n                  style={{ borderColor: data.color || '#667eea' }}\n                  title={data.username}\n                >\n                  {data.username?.[0]?.toUpperCase() || 'U'}\n                </span>\n              ))}\n            </div>\n          )}\n        </div>\n      </header>\n\n      <div className=\"editor-content\">\n        <textarea\n          ref={editorRef}\n          value={content}\n          onChange={handleTextChange}\n          onSelect={handleCursorChange}\n          onKeyUp={handleCursorChange}\n          onMouseUp={handleCursorChange}\n          className=\"editor-textarea\"\n          placeholder=\"Start typing...\"\n          spellCheck={false}\n        />\n      </div>\n\n      {isOffline && pendingOperations.length > 0 && (\n        <div className=\"offline-indicator\">\n          {pendingOperations.length} pending change(s) - will sync when reconnected\n        </div>\n      )}\n\n      <DocumentSettings\n        documentId={documentId}\n        isOpen={showSettings}\n        onClose={() => setShowSettings(false)}\n        userRole={userRole}\n        onUpdate={fetchDocumentInfo}\n      />\n    </div>\n  );\n}\n\nexport default Editor;\n\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}