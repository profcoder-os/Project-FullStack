{"ast":null,"code":"var _jsxFileName = \"/Users/dheerajkumar/Desktop/Collaborative_Editor/client/src/components/Editor.js\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useRef, useState, useCallback } from 'react';\nimport { useParams, useNavigate } from 'react-router-dom';\nimport { io } from 'socket.io-client';\nimport * as Y from 'yjs';\nimport axios from 'axios';\nimport { toast } from 'react-toastify';\nimport DocumentSettings from './DocumentSettings';\nimport './Editor.css';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst API_URL = process.env.REACT_APP_API_URL || 'http://localhost:5001/api';\nconst WS_URL = process.env.REACT_APP_WS_URL || 'http://localhost:5001';\nfunction Editor() {\n  _s();\n  const {\n    documentId\n  } = useParams();\n  const navigate = useNavigate();\n  const editorRef = useRef(null);\n  const socketRef = useRef(null);\n  const ydocRef = useRef(null);\n  const ytextRef = useRef(null);\n  const [connected, setConnected] = useState(false);\n  const [documentTitle, setDocumentTitle] = useState('Loading...');\n  const [content, setContent] = useState('');\n  const [presence, setPresence] = useState({});\n  const [pendingOperations, setPendingOperations] = useState([]);\n  const [isOffline, setIsOffline] = useState(false);\n  const [showSettings, setShowSettings] = useState(false);\n  const [userRole, setUserRole] = useState('viewer');\n  const cursorThrottleRef = useRef(0);\n  const lastCursorRef = useRef({\n    position: 0,\n    selectionStart: 0,\n    selectionEnd: 0\n  });\n  const clientIdRef = useRef(0);\n  const vectorClockRef = useRef({});\n  const isLocalChangeRef = useRef(false);\n  useEffect(() => {\n    fetchDocumentInfo();\n    initializeEditor();\n    return () => {\n      cleanup();\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [documentId]);\n  const fetchDocumentInfo = async () => {\n    try {\n      var _doc$owner;\n      const response = await axios.get(`${API_URL}/documents/${documentId}`);\n      setDocumentTitle(response.data.document.title);\n\n      // Determine user role\n      const doc = response.data.document;\n      const currentUserId = localStorage.getItem('userId'); // We'll need to get this from auth\n      if (((_doc$owner = doc.owner) === null || _doc$owner === void 0 ? void 0 : _doc$owner.id) === currentUserId) {\n        setUserRole('owner');\n      } else {\n        var _doc$accessControl;\n        const access = (_doc$accessControl = doc.accessControl) === null || _doc$accessControl === void 0 ? void 0 : _doc$accessControl.find(ac => ac.user.id === currentUserId);\n        setUserRole((access === null || access === void 0 ? void 0 : access.role) || 'viewer');\n      }\n    } catch (error) {\n      console.error('Error fetching document info:', error);\n      toast.error('Failed to load document');\n    }\n  };\n  const initializeEditor = async () => {\n    try {\n      // Initialize Yjs document\n      const ydoc = new Y.Doc();\n      const ytext = ydoc.getText('content');\n      ydocRef.current = ydoc;\n      ytextRef.current = ytext;\n\n      // Initialize WebSocket connection\n      const token = localStorage.getItem('token');\n      const socket = io(WS_URL, {\n        auth: {\n          token\n        },\n        transports: ['websocket'],\n        reconnection: true,\n        reconnectionDelay: 1000,\n        reconnectionAttempts: 5\n      });\n      socketRef.current = socket;\n\n      // Socket event handlers\n      socket.on('connect', () => {\n        setConnected(true);\n        setIsOffline(false);\n        toast.success('Connected');\n        socket.emit('join-document', {\n          documentId\n        });\n      });\n      socket.on('disconnect', () => {\n        setConnected(false);\n        setIsOffline(true);\n        toast.warning('Disconnected. Changes will sync when reconnected.');\n      });\n      socket.on('connect_error', error => {\n        console.error('Connection error:', error);\n        toast.error('Connection failed');\n      });\n      socket.on('document-state', async ({\n        state,\n        version,\n        vectorClock\n      }) => {\n        try {\n          const stateBuffer = Uint8Array.from(atob(state), c => c.charCodeAt(0));\n          Y.applyUpdate(ydoc, stateBuffer);\n          vectorClockRef.current = vectorClock || {};\n\n          // Process pending operations\n          if (pendingOperations.length > 0) {\n            await processPendingOperations();\n          }\n        } catch (error) {\n          console.error('Error applying document state:', error);\n        }\n      });\n      socket.on('document-update', ({\n        update,\n        vectorClock,\n        lamportTimestamp,\n        userId,\n        clientId\n      }) => {\n        try {\n          // Skip if this is our own update (already applied optimistically)\n          if (clientId === clientIdRef.current) {\n            return;\n          }\n          const updateBuffer = Uint8Array.from(atob(update), c => c.charCodeAt(0));\n          Y.applyUpdate(ydoc, updateBuffer);\n          vectorClockRef.current = vectorClock || {};\n        } catch (error) {\n          console.error('Error applying update:', error);\n        }\n      });\n      socket.on('update-ack', ({\n        clientId,\n        vectorClock,\n        lamportTimestamp\n      }) => {\n        // Remove acknowledged operation from pending queue\n        setPendingOperations(prev => prev.filter(op => op.clientId !== clientId));\n        vectorClockRef.current = vectorClock || {};\n      });\n      socket.on('cursor-update', ({\n        userId,\n        username,\n        cursor\n      }) => {\n        setPresence(prev => ({\n          ...prev,\n          [userId]: {\n            ...prev[userId],\n            cursor,\n            username\n          }\n        }));\n      });\n      socket.on('user-joined', ({\n        userId,\n        username,\n        color\n      }) => {\n        setPresence(prev => ({\n          ...prev,\n          [userId]: {\n            username,\n            color,\n            cursor: null\n          }\n        }));\n        toast.info(`${username} joined`);\n      });\n      socket.on('user-left', ({\n        userId,\n        username\n      }) => {\n        setPresence(prev => {\n          const updated = {\n            ...prev\n          };\n          delete updated[userId];\n          return updated;\n        });\n        toast.info(`${username} left`);\n      });\n      socket.on('presence-update', ({\n        users\n      }) => {\n        const presenceMap = {};\n        users.forEach(user => {\n          presenceMap[user.userId] = user;\n        });\n        setPresence(presenceMap);\n      });\n      socket.on('error', ({\n        message\n      }) => {\n        toast.error(message);\n        if (message.includes('Access denied') || message.includes('not found')) {\n          navigate('/documents');\n        }\n      });\n\n      // Yjs text observer - only update if change came from Yjs (not from our own input)\n      ytext.observe(event => {\n        if (!isLocalChangeRef.current) {\n          const text = ytext.toString();\n          setContent(text);\n          // Sync cursor position if needed\n          if (editorRef.current) {\n            const textarea = editorRef.current;\n            const cursorPos = Math.min(textarea.selectionStart, text.length);\n            textarea.setSelectionRange(cursorPos, cursorPos);\n          }\n        }\n        isLocalChangeRef.current = false;\n      });\n\n      // Initial content\n      setContent(ytext.toString());\n    } catch (error) {\n      console.error('Initialization error:', error);\n      toast.error('Failed to initialize editor');\n    }\n  };\n  const processPendingOperations = async () => {\n    var _socketRef$current;\n    if (!((_socketRef$current = socketRef.current) !== null && _socketRef$current !== void 0 && _socketRef$current.connected) || pendingOperations.length === 0) {\n      return;\n    }\n    const operations = [...pendingOperations];\n    setPendingOperations([]);\n    for (const op of operations) {\n      try {\n        socketRef.current.emit('document-update', {\n          documentId,\n          update: op.update,\n          vectorClock: op.vectorClock,\n          clientId: op.clientId\n        });\n      } catch (error) {\n        console.error('Error sending pending operation:', error);\n        setPendingOperations(prev => [...prev, op]);\n      }\n    }\n  };\n  const handleTextChange = useCallback(e => {\n    var _socketRef$current2;\n    if (!ytextRef.current || !ydocRef.current) return;\n    const newValue = e.target.value;\n    const oldValue = ytextRef.current.toString();\n    if (newValue === oldValue) return;\n\n    // Mark as local change to prevent observer from updating\n    isLocalChangeRef.current = true;\n\n    // Calculate diff\n    const diff = calculateDiff(oldValue, newValue);\n\n    // Apply changes to Yjs\n    if (diff.type === 'insert') {\n      ytextRef.current.insert(diff.index, diff.text);\n    } else if (diff.type === 'delete') {\n      ytextRef.current.delete(diff.index, diff.length);\n    } else if (diff.type === 'replace') {\n      ytextRef.current.delete(diff.index, diff.length);\n      ytextRef.current.insert(diff.index, diff.insert);\n    }\n\n    // Send update optimistically\n    const update = Y.encodeStateAsUpdate(ydocRef.current);\n    const clientId = ++clientIdRef.current;\n    const updateBase64 = btoa(String.fromCharCode(...update));\n    if ((_socketRef$current2 = socketRef.current) !== null && _socketRef$current2 !== void 0 && _socketRef$current2.connected) {\n      socketRef.current.emit('document-update', {\n        documentId,\n        update: updateBase64,\n        vectorClock: vectorClockRef.current,\n        clientId\n      });\n\n      // Add to pending operations for ACK tracking\n      setPendingOperations(prev => [...prev, {\n        clientId,\n        update: updateBase64,\n        vectorClock: vectorClockRef.current,\n        timestamp: Date.now()\n      }]);\n    } else {\n      // Queue for offline\n      setPendingOperations(prev => [...prev, {\n        clientId,\n        update: updateBase64,\n        vectorClock: vectorClockRef.current,\n        timestamp: Date.now()\n      }]);\n      setIsOffline(true);\n    }\n  }, [documentId]);\n  const calculateDiff = (oldText, newText) => {\n    let i = 0;\n    while (i < oldText.length && i < newText.length && oldText[i] === newText[i]) {\n      i++;\n    }\n    let j = oldText.length - 1;\n    let k = newText.length - 1;\n    while (j >= i && k >= i && oldText[j] === newText[k]) {\n      j--;\n      k--;\n    }\n    if (i > j) {\n      // Insertion\n      return {\n        type: 'insert',\n        index: i,\n        text: newText.substring(i, k + 1)\n      };\n    } else if (i > k) {\n      // Deletion\n      return {\n        type: 'delete',\n        index: i,\n        length: j - i + 1\n      };\n    } else {\n      // Replacement\n      return {\n        type: 'replace',\n        index: i,\n        length: j - i + 1,\n        insert: newText.substring(i, k + 1)\n      };\n    }\n  };\n  const handleCursorChange = useCallback(() => {\n    var _socketRef$current3;\n    if (!editorRef.current) return;\n    const textarea = editorRef.current;\n    const position = textarea.selectionStart;\n    const selectionStart = textarea.selectionStart;\n    const selectionEnd = textarea.selectionEnd;\n\n    // Throttle cursor updates (max once per 50ms)\n    const now = Date.now();\n    if (now - cursorThrottleRef.current < 50) {\n      return;\n    }\n    cursorThrottleRef.current = now;\n\n    // Only send if cursor actually changed\n    if (position === lastCursorRef.current.position && selectionStart === lastCursorRef.current.selectionStart && selectionEnd === lastCursorRef.current.selectionEnd) {\n      return;\n    }\n    lastCursorRef.current = {\n      position,\n      selectionStart,\n      selectionEnd\n    };\n    if ((_socketRef$current3 = socketRef.current) !== null && _socketRef$current3 !== void 0 && _socketRef$current3.connected) {\n      socketRef.current.emit('cursor-update', {\n        documentId,\n        cursor: {\n          position,\n          selectionStart,\n          selectionEnd\n        }\n      });\n    }\n  }, [documentId]);\n  const cleanup = () => {\n    if (socketRef.current) {\n      socketRef.current.disconnect();\n      socketRef.current = null;\n    }\n    if (ydocRef.current) {\n      ydocRef.current.destroy();\n      ydocRef.current = null;\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"editor-container\",\n    children: [/*#__PURE__*/_jsxDEV(\"header\", {\n      className: \"editor-header\",\n      children: [/*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: () => navigate('/documents'),\n        className: \"back-btn\",\n        children: \"\\u2190 Back\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 353,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"h1\", {\n        children: documentTitle\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 356,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"header-actions\",\n        children: /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: () => setShowSettings(true),\n          className: \"settings-btn\",\n          children: \"\\u2699\\uFE0F Settings\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 358,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 357,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"editor-status\",\n        children: [/*#__PURE__*/_jsxDEV(\"span\", {\n          className: `status-indicator ${connected ? 'connected' : 'disconnected'}`,\n          children: connected ? '● Connected' : '○ Disconnected'\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 363,\n          columnNumber: 11\n        }, this), Object.keys(presence).length > 0 && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"presence-indicators\",\n          children: Object.entries(presence).map(([userId, data]) => {\n            var _data$username, _data$username$;\n            return /*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"presence-badge\",\n              style: {\n                borderColor: data.color || '#667eea'\n              },\n              title: data.username,\n              children: ((_data$username = data.username) === null || _data$username === void 0 ? void 0 : (_data$username$ = _data$username[0]) === null || _data$username$ === void 0 ? void 0 : _data$username$.toUpperCase()) || 'U'\n            }, userId, false, {\n              fileName: _jsxFileName,\n              lineNumber: 369,\n              columnNumber: 17\n            }, this);\n          })\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 367,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 362,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 352,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"editor-content\",\n      children: /*#__PURE__*/_jsxDEV(\"textarea\", {\n        ref: editorRef,\n        value: content,\n        onChange: handleTextChange,\n        onSelect: handleCursorChange,\n        onKeyUp: handleCursorChange,\n        onMouseUp: handleCursorChange,\n        className: \"editor-textarea\",\n        placeholder: \"Start typing...\",\n        spellCheck: false\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 384,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 383,\n      columnNumber: 7\n    }, this), isOffline && pendingOperations.length > 0 && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"offline-indicator\",\n      children: [pendingOperations.length, \" pending change(s) - will sync when reconnected\"]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 398,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(DocumentSettings, {\n      documentId: documentId,\n      isOpen: showSettings,\n      onClose: () => setShowSettings(false),\n      userRole: userRole,\n      onUpdate: fetchDocumentInfo\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 403,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 351,\n    columnNumber: 5\n  }, this);\n}\n_s(Editor, \"MSgjWhk+AinUYd6g5cPuy1AzMMo=\", false, function () {\n  return [useParams, useNavigate];\n});\n_c = Editor;\nexport default Editor;\nvar _c;\n$RefreshReg$(_c, \"Editor\");","map":{"version":3,"names":["React","useEffect","useRef","useState","useCallback","useParams","useNavigate","io","Y","axios","toast","DocumentSettings","jsxDEV","_jsxDEV","API_URL","process","env","REACT_APP_API_URL","WS_URL","REACT_APP_WS_URL","Editor","_s","documentId","navigate","editorRef","socketRef","ydocRef","ytextRef","connected","setConnected","documentTitle","setDocumentTitle","content","setContent","presence","setPresence","pendingOperations","setPendingOperations","isOffline","setIsOffline","showSettings","setShowSettings","userRole","setUserRole","cursorThrottleRef","lastCursorRef","position","selectionStart","selectionEnd","clientIdRef","vectorClockRef","isLocalChangeRef","fetchDocumentInfo","initializeEditor","cleanup","_doc$owner","response","get","data","document","title","doc","currentUserId","localStorage","getItem","owner","id","_doc$accessControl","access","accessControl","find","ac","user","role","error","console","ydoc","Doc","ytext","getText","current","token","socket","auth","transports","reconnection","reconnectionDelay","reconnectionAttempts","on","success","emit","warning","state","version","vectorClock","stateBuffer","Uint8Array","from","atob","c","charCodeAt","applyUpdate","length","processPendingOperations","update","lamportTimestamp","userId","clientId","updateBuffer","prev","filter","op","username","cursor","color","info","updated","users","presenceMap","forEach","message","includes","observe","event","text","toString","textarea","cursorPos","Math","min","setSelectionRange","_socketRef$current","operations","handleTextChange","e","_socketRef$current2","newValue","target","value","oldValue","diff","calculateDiff","type","insert","index","delete","encodeStateAsUpdate","updateBase64","btoa","String","fromCharCode","timestamp","Date","now","oldText","newText","i","j","k","substring","handleCursorChange","_socketRef$current3","disconnect","destroy","className","children","onClick","fileName","_jsxFileName","lineNumber","columnNumber","Object","keys","entries","map","_data$username","_data$username$","style","borderColor","toUpperCase","ref","onChange","onSelect","onKeyUp","onMouseUp","placeholder","spellCheck","isOpen","onClose","onUpdate","_c","$RefreshReg$"],"sources":["/Users/dheerajkumar/Desktop/Collaborative_Editor/client/src/components/Editor.js"],"sourcesContent":["import React, { useEffect, useRef, useState, useCallback } from 'react';\nimport { useParams, useNavigate } from 'react-router-dom';\nimport { io } from 'socket.io-client';\nimport * as Y from 'yjs';\nimport axios from 'axios';\nimport { toast } from 'react-toastify';\nimport DocumentSettings from './DocumentSettings';\nimport './Editor.css';\n\nconst API_URL = process.env.REACT_APP_API_URL || 'http://localhost:5001/api';\nconst WS_URL = process.env.REACT_APP_WS_URL || 'http://localhost:5001';\n\nfunction Editor() {\n  const { documentId } = useParams();\n  const navigate = useNavigate();\n  const editorRef = useRef(null);\n  const socketRef = useRef(null);\n  const ydocRef = useRef(null);\n  const ytextRef = useRef(null);\n  const [connected, setConnected] = useState(false);\n  const [documentTitle, setDocumentTitle] = useState('Loading...');\n  const [content, setContent] = useState('');\n  const [presence, setPresence] = useState({});\n  const [pendingOperations, setPendingOperations] = useState([]);\n  const [isOffline, setIsOffline] = useState(false);\n  const [showSettings, setShowSettings] = useState(false);\n  const [userRole, setUserRole] = useState('viewer');\n  const cursorThrottleRef = useRef(0);\n  const lastCursorRef = useRef({ position: 0, selectionStart: 0, selectionEnd: 0 });\n  const clientIdRef = useRef(0);\n  const vectorClockRef = useRef({});\n  const isLocalChangeRef = useRef(false);\n\n  useEffect(() => {\n    fetchDocumentInfo();\n    initializeEditor();\n    return () => {\n      cleanup();\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [documentId]);\n\n  const fetchDocumentInfo = async () => {\n    try {\n      const response = await axios.get(`${API_URL}/documents/${documentId}`);\n      setDocumentTitle(response.data.document.title);\n      \n      // Determine user role\n      const doc = response.data.document;\n      const currentUserId = localStorage.getItem('userId'); // We'll need to get this from auth\n      if (doc.owner?.id === currentUserId) {\n        setUserRole('owner');\n      } else {\n        const access = doc.accessControl?.find(ac => ac.user.id === currentUserId);\n        setUserRole(access?.role || 'viewer');\n      }\n    } catch (error) {\n      console.error('Error fetching document info:', error);\n      toast.error('Failed to load document');\n    }\n  };\n\n  const initializeEditor = async () => {\n    try {\n      // Initialize Yjs document\n      const ydoc = new Y.Doc();\n      const ytext = ydoc.getText('content');\n      ydocRef.current = ydoc;\n      ytextRef.current = ytext;\n\n      // Initialize WebSocket connection\n      const token = localStorage.getItem('token');\n      const socket = io(WS_URL, {\n        auth: { token },\n        transports: ['websocket'],\n        reconnection: true,\n        reconnectionDelay: 1000,\n        reconnectionAttempts: 5,\n      });\n\n      socketRef.current = socket;\n\n      // Socket event handlers\n      socket.on('connect', () => {\n        setConnected(true);\n        setIsOffline(false);\n        toast.success('Connected');\n        socket.emit('join-document', { documentId });\n      });\n\n      socket.on('disconnect', () => {\n        setConnected(false);\n        setIsOffline(true);\n        toast.warning('Disconnected. Changes will sync when reconnected.');\n      });\n\n      socket.on('connect_error', (error) => {\n        console.error('Connection error:', error);\n        toast.error('Connection failed');\n      });\n\n      socket.on('document-state', async ({ state, version, vectorClock }) => {\n        try {\n          const stateBuffer = Uint8Array.from(atob(state), c => c.charCodeAt(0));\n          Y.applyUpdate(ydoc, stateBuffer);\n          vectorClockRef.current = vectorClock || {};\n          \n          // Process pending operations\n          if (pendingOperations.length > 0) {\n            await processPendingOperations();\n          }\n        } catch (error) {\n          console.error('Error applying document state:', error);\n        }\n      });\n\n      socket.on('document-update', ({ update, vectorClock, lamportTimestamp, userId, clientId }) => {\n        try {\n          // Skip if this is our own update (already applied optimistically)\n          if (clientId === clientIdRef.current) {\n            return;\n          }\n\n          const updateBuffer = Uint8Array.from(atob(update), c => c.charCodeAt(0));\n          Y.applyUpdate(ydoc, updateBuffer);\n          vectorClockRef.current = vectorClock || {};\n        } catch (error) {\n          console.error('Error applying update:', error);\n        }\n      });\n\n      socket.on('update-ack', ({ clientId, vectorClock, lamportTimestamp }) => {\n        // Remove acknowledged operation from pending queue\n        setPendingOperations(prev => prev.filter(op => op.clientId !== clientId));\n        vectorClockRef.current = vectorClock || {};\n      });\n\n      socket.on('cursor-update', ({ userId, username, cursor }) => {\n        setPresence(prev => ({\n          ...prev,\n          [userId]: { ...prev[userId], cursor, username },\n        }));\n      });\n\n      socket.on('user-joined', ({ userId, username, color }) => {\n        setPresence(prev => ({\n          ...prev,\n          [userId]: { username, color, cursor: null },\n        }));\n        toast.info(`${username} joined`);\n      });\n\n      socket.on('user-left', ({ userId, username }) => {\n        setPresence(prev => {\n          const updated = { ...prev };\n          delete updated[userId];\n          return updated;\n        });\n        toast.info(`${username} left`);\n      });\n\n      socket.on('presence-update', ({ users }) => {\n        const presenceMap = {};\n        users.forEach(user => {\n          presenceMap[user.userId] = user;\n        });\n        setPresence(presenceMap);\n      });\n\n      socket.on('error', ({ message }) => {\n        toast.error(message);\n        if (message.includes('Access denied') || message.includes('not found')) {\n          navigate('/documents');\n        }\n      });\n\n      // Yjs text observer - only update if change came from Yjs (not from our own input)\n      ytext.observe((event) => {\n        if (!isLocalChangeRef.current) {\n          const text = ytext.toString();\n          setContent(text);\n          // Sync cursor position if needed\n          if (editorRef.current) {\n            const textarea = editorRef.current;\n            const cursorPos = Math.min(textarea.selectionStart, text.length);\n            textarea.setSelectionRange(cursorPos, cursorPos);\n          }\n        }\n        isLocalChangeRef.current = false;\n      });\n\n      // Initial content\n      setContent(ytext.toString());\n\n    } catch (error) {\n      console.error('Initialization error:', error);\n      toast.error('Failed to initialize editor');\n    }\n  };\n\n  const processPendingOperations = async () => {\n    if (!socketRef.current?.connected || pendingOperations.length === 0) {\n      return;\n    }\n\n    const operations = [...pendingOperations];\n    setPendingOperations([]);\n\n    for (const op of operations) {\n      try {\n        socketRef.current.emit('document-update', {\n          documentId,\n          update: op.update,\n          vectorClock: op.vectorClock,\n          clientId: op.clientId,\n        });\n      } catch (error) {\n        console.error('Error sending pending operation:', error);\n        setPendingOperations(prev => [...prev, op]);\n      }\n    }\n  };\n\n  const handleTextChange = useCallback((e) => {\n    if (!ytextRef.current || !ydocRef.current) return;\n\n    const newValue = e.target.value;\n    const oldValue = ytextRef.current.toString();\n    \n    if (newValue === oldValue) return;\n\n    // Mark as local change to prevent observer from updating\n    isLocalChangeRef.current = true;\n    \n    // Calculate diff\n    const diff = calculateDiff(oldValue, newValue);\n    \n    // Apply changes to Yjs\n    if (diff.type === 'insert') {\n      ytextRef.current.insert(diff.index, diff.text);\n    } else if (diff.type === 'delete') {\n      ytextRef.current.delete(diff.index, diff.length);\n    } else if (diff.type === 'replace') {\n      ytextRef.current.delete(diff.index, diff.length);\n      ytextRef.current.insert(diff.index, diff.insert);\n    }\n\n    // Send update optimistically\n    const update = Y.encodeStateAsUpdate(ydocRef.current);\n    const clientId = ++clientIdRef.current;\n    const updateBase64 = btoa(String.fromCharCode(...update));\n\n    if (socketRef.current?.connected) {\n      socketRef.current.emit('document-update', {\n        documentId,\n        update: updateBase64,\n        vectorClock: vectorClockRef.current,\n        clientId,\n      });\n\n      // Add to pending operations for ACK tracking\n      setPendingOperations(prev => [...prev, {\n        clientId,\n        update: updateBase64,\n        vectorClock: vectorClockRef.current,\n        timestamp: Date.now(),\n      }]);\n    } else {\n      // Queue for offline\n      setPendingOperations(prev => [...prev, {\n        clientId,\n        update: updateBase64,\n        vectorClock: vectorClockRef.current,\n        timestamp: Date.now(),\n      }]);\n      setIsOffline(true);\n    }\n  }, [documentId]);\n\n  const calculateDiff = (oldText, newText) => {\n    let i = 0;\n    while (i < oldText.length && i < newText.length && oldText[i] === newText[i]) {\n      i++;\n    }\n\n    let j = oldText.length - 1;\n    let k = newText.length - 1;\n    while (j >= i && k >= i && oldText[j] === newText[k]) {\n      j--;\n      k--;\n    }\n\n    if (i > j) {\n      // Insertion\n      return { type: 'insert', index: i, text: newText.substring(i, k + 1) };\n    } else if (i > k) {\n      // Deletion\n      return { type: 'delete', index: i, length: j - i + 1 };\n    } else {\n      // Replacement\n      return { type: 'replace', index: i, length: j - i + 1, insert: newText.substring(i, k + 1) };\n    }\n  };\n\n  const handleCursorChange = useCallback(() => {\n    if (!editorRef.current) return;\n\n    const textarea = editorRef.current;\n    const position = textarea.selectionStart;\n    const selectionStart = textarea.selectionStart;\n    const selectionEnd = textarea.selectionEnd;\n\n    // Throttle cursor updates (max once per 50ms)\n    const now = Date.now();\n    if (now - cursorThrottleRef.current < 50) {\n      return;\n    }\n    cursorThrottleRef.current = now;\n\n    // Only send if cursor actually changed\n    if (\n      position === lastCursorRef.current.position &&\n      selectionStart === lastCursorRef.current.selectionStart &&\n      selectionEnd === lastCursorRef.current.selectionEnd\n    ) {\n      return;\n    }\n\n    lastCursorRef.current = { position, selectionStart, selectionEnd };\n\n    if (socketRef.current?.connected) {\n      socketRef.current.emit('cursor-update', {\n        documentId,\n        cursor: { position, selectionStart, selectionEnd },\n      });\n    }\n  }, [documentId]);\n\n  const cleanup = () => {\n    if (socketRef.current) {\n      socketRef.current.disconnect();\n      socketRef.current = null;\n    }\n    if (ydocRef.current) {\n      ydocRef.current.destroy();\n      ydocRef.current = null;\n    }\n  };\n\n  return (\n    <div className=\"editor-container\">\n      <header className=\"editor-header\">\n        <button onClick={() => navigate('/documents')} className=\"back-btn\">\n          ← Back\n        </button>\n        <h1>{documentTitle}</h1>\n        <div className=\"header-actions\">\n          <button onClick={() => setShowSettings(true)} className=\"settings-btn\">\n            ⚙️ Settings\n          </button>\n        </div>\n        <div className=\"editor-status\">\n          <span className={`status-indicator ${connected ? 'connected' : 'disconnected'}`}>\n            {connected ? '● Connected' : '○ Disconnected'}\n          </span>\n          {Object.keys(presence).length > 0 && (\n            <div className=\"presence-indicators\">\n              {Object.entries(presence).map(([userId, data]) => (\n                <span\n                  key={userId}\n                  className=\"presence-badge\"\n                  style={{ borderColor: data.color || '#667eea' }}\n                  title={data.username}\n                >\n                  {data.username?.[0]?.toUpperCase() || 'U'}\n                </span>\n              ))}\n            </div>\n          )}\n        </div>\n      </header>\n\n      <div className=\"editor-content\">\n        <textarea\n          ref={editorRef}\n          value={content}\n          onChange={handleTextChange}\n          onSelect={handleCursorChange}\n          onKeyUp={handleCursorChange}\n          onMouseUp={handleCursorChange}\n          className=\"editor-textarea\"\n          placeholder=\"Start typing...\"\n          spellCheck={false}\n        />\n      </div>\n\n      {isOffline && pendingOperations.length > 0 && (\n        <div className=\"offline-indicator\">\n          {pendingOperations.length} pending change(s) - will sync when reconnected\n        </div>\n      )}\n\n      <DocumentSettings\n        documentId={documentId}\n        isOpen={showSettings}\n        onClose={() => setShowSettings(false)}\n        userRole={userRole}\n        onUpdate={fetchDocumentInfo}\n      />\n    </div>\n  );\n}\n\nexport default Editor;\n\n"],"mappings":";;AAAA,OAAOA,KAAK,IAAIC,SAAS,EAAEC,MAAM,EAAEC,QAAQ,EAAEC,WAAW,QAAQ,OAAO;AACvE,SAASC,SAAS,EAAEC,WAAW,QAAQ,kBAAkB;AACzD,SAASC,EAAE,QAAQ,kBAAkB;AACrC,OAAO,KAAKC,CAAC,MAAM,KAAK;AACxB,OAAOC,KAAK,MAAM,OAAO;AACzB,SAASC,KAAK,QAAQ,gBAAgB;AACtC,OAAOC,gBAAgB,MAAM,oBAAoB;AACjD,OAAO,cAAc;AAAC,SAAAC,MAAA,IAAAC,OAAA;AAEtB,MAAMC,OAAO,GAAGC,OAAO,CAACC,GAAG,CAACC,iBAAiB,IAAI,2BAA2B;AAC5E,MAAMC,MAAM,GAAGH,OAAO,CAACC,GAAG,CAACG,gBAAgB,IAAI,uBAAuB;AAEtE,SAASC,MAAMA,CAAA,EAAG;EAAAC,EAAA;EAChB,MAAM;IAAEC;EAAW,CAAC,GAAGjB,SAAS,CAAC,CAAC;EAClC,MAAMkB,QAAQ,GAAGjB,WAAW,CAAC,CAAC;EAC9B,MAAMkB,SAAS,GAAGtB,MAAM,CAAC,IAAI,CAAC;EAC9B,MAAMuB,SAAS,GAAGvB,MAAM,CAAC,IAAI,CAAC;EAC9B,MAAMwB,OAAO,GAAGxB,MAAM,CAAC,IAAI,CAAC;EAC5B,MAAMyB,QAAQ,GAAGzB,MAAM,CAAC,IAAI,CAAC;EAC7B,MAAM,CAAC0B,SAAS,EAAEC,YAAY,CAAC,GAAG1B,QAAQ,CAAC,KAAK,CAAC;EACjD,MAAM,CAAC2B,aAAa,EAAEC,gBAAgB,CAAC,GAAG5B,QAAQ,CAAC,YAAY,CAAC;EAChE,MAAM,CAAC6B,OAAO,EAAEC,UAAU,CAAC,GAAG9B,QAAQ,CAAC,EAAE,CAAC;EAC1C,MAAM,CAAC+B,QAAQ,EAAEC,WAAW,CAAC,GAAGhC,QAAQ,CAAC,CAAC,CAAC,CAAC;EAC5C,MAAM,CAACiC,iBAAiB,EAAEC,oBAAoB,CAAC,GAAGlC,QAAQ,CAAC,EAAE,CAAC;EAC9D,MAAM,CAACmC,SAAS,EAAEC,YAAY,CAAC,GAAGpC,QAAQ,CAAC,KAAK,CAAC;EACjD,MAAM,CAACqC,YAAY,EAAEC,eAAe,CAAC,GAAGtC,QAAQ,CAAC,KAAK,CAAC;EACvD,MAAM,CAACuC,QAAQ,EAAEC,WAAW,CAAC,GAAGxC,QAAQ,CAAC,QAAQ,CAAC;EAClD,MAAMyC,iBAAiB,GAAG1C,MAAM,CAAC,CAAC,CAAC;EACnC,MAAM2C,aAAa,GAAG3C,MAAM,CAAC;IAAE4C,QAAQ,EAAE,CAAC;IAAEC,cAAc,EAAE,CAAC;IAAEC,YAAY,EAAE;EAAE,CAAC,CAAC;EACjF,MAAMC,WAAW,GAAG/C,MAAM,CAAC,CAAC,CAAC;EAC7B,MAAMgD,cAAc,GAAGhD,MAAM,CAAC,CAAC,CAAC,CAAC;EACjC,MAAMiD,gBAAgB,GAAGjD,MAAM,CAAC,KAAK,CAAC;EAEtCD,SAAS,CAAC,MAAM;IACdmD,iBAAiB,CAAC,CAAC;IACnBC,gBAAgB,CAAC,CAAC;IAClB,OAAO,MAAM;MACXC,OAAO,CAAC,CAAC;IACX,CAAC;IACD;EACF,CAAC,EAAE,CAAChC,UAAU,CAAC,CAAC;EAEhB,MAAM8B,iBAAiB,GAAG,MAAAA,CAAA,KAAY;IACpC,IAAI;MAAA,IAAAG,UAAA;MACF,MAAMC,QAAQ,GAAG,MAAM/C,KAAK,CAACgD,GAAG,CAAC,GAAG3C,OAAO,cAAcQ,UAAU,EAAE,CAAC;MACtES,gBAAgB,CAACyB,QAAQ,CAACE,IAAI,CAACC,QAAQ,CAACC,KAAK,CAAC;;MAE9C;MACA,MAAMC,GAAG,GAAGL,QAAQ,CAACE,IAAI,CAACC,QAAQ;MAClC,MAAMG,aAAa,GAAGC,YAAY,CAACC,OAAO,CAAC,QAAQ,CAAC,CAAC,CAAC;MACtD,IAAI,EAAAT,UAAA,GAAAM,GAAG,CAACI,KAAK,cAAAV,UAAA,uBAATA,UAAA,CAAWW,EAAE,MAAKJ,aAAa,EAAE;QACnCnB,WAAW,CAAC,OAAO,CAAC;MACtB,CAAC,MAAM;QAAA,IAAAwB,kBAAA;QACL,MAAMC,MAAM,IAAAD,kBAAA,GAAGN,GAAG,CAACQ,aAAa,cAAAF,kBAAA,uBAAjBA,kBAAA,CAAmBG,IAAI,CAACC,EAAE,IAAIA,EAAE,CAACC,IAAI,CAACN,EAAE,KAAKJ,aAAa,CAAC;QAC1EnB,WAAW,CAAC,CAAAyB,MAAM,aAANA,MAAM,uBAANA,MAAM,CAAEK,IAAI,KAAI,QAAQ,CAAC;MACvC;IACF,CAAC,CAAC,OAAOC,KAAK,EAAE;MACdC,OAAO,CAACD,KAAK,CAAC,+BAA+B,EAAEA,KAAK,CAAC;MACrDhE,KAAK,CAACgE,KAAK,CAAC,yBAAyB,CAAC;IACxC;EACF,CAAC;EAED,MAAMrB,gBAAgB,GAAG,MAAAA,CAAA,KAAY;IACnC,IAAI;MACF;MACA,MAAMuB,IAAI,GAAG,IAAIpE,CAAC,CAACqE,GAAG,CAAC,CAAC;MACxB,MAAMC,KAAK,GAAGF,IAAI,CAACG,OAAO,CAAC,SAAS,CAAC;MACrCrD,OAAO,CAACsD,OAAO,GAAGJ,IAAI;MACtBjD,QAAQ,CAACqD,OAAO,GAAGF,KAAK;;MAExB;MACA,MAAMG,KAAK,GAAGlB,YAAY,CAACC,OAAO,CAAC,OAAO,CAAC;MAC3C,MAAMkB,MAAM,GAAG3E,EAAE,CAACW,MAAM,EAAE;QACxBiE,IAAI,EAAE;UAAEF;QAAM,CAAC;QACfG,UAAU,EAAE,CAAC,WAAW,CAAC;QACzBC,YAAY,EAAE,IAAI;QAClBC,iBAAiB,EAAE,IAAI;QACvBC,oBAAoB,EAAE;MACxB,CAAC,CAAC;MAEF9D,SAAS,CAACuD,OAAO,GAAGE,MAAM;;MAE1B;MACAA,MAAM,CAACM,EAAE,CAAC,SAAS,EAAE,MAAM;QACzB3D,YAAY,CAAC,IAAI,CAAC;QAClBU,YAAY,CAAC,KAAK,CAAC;QACnB7B,KAAK,CAAC+E,OAAO,CAAC,WAAW,CAAC;QAC1BP,MAAM,CAACQ,IAAI,CAAC,eAAe,EAAE;UAAEpE;QAAW,CAAC,CAAC;MAC9C,CAAC,CAAC;MAEF4D,MAAM,CAACM,EAAE,CAAC,YAAY,EAAE,MAAM;QAC5B3D,YAAY,CAAC,KAAK,CAAC;QACnBU,YAAY,CAAC,IAAI,CAAC;QAClB7B,KAAK,CAACiF,OAAO,CAAC,mDAAmD,CAAC;MACpE,CAAC,CAAC;MAEFT,MAAM,CAACM,EAAE,CAAC,eAAe,EAAGd,KAAK,IAAK;QACpCC,OAAO,CAACD,KAAK,CAAC,mBAAmB,EAAEA,KAAK,CAAC;QACzChE,KAAK,CAACgE,KAAK,CAAC,mBAAmB,CAAC;MAClC,CAAC,CAAC;MAEFQ,MAAM,CAACM,EAAE,CAAC,gBAAgB,EAAE,OAAO;QAAEI,KAAK;QAAEC,OAAO;QAAEC;MAAY,CAAC,KAAK;QACrE,IAAI;UACF,MAAMC,WAAW,GAAGC,UAAU,CAACC,IAAI,CAACC,IAAI,CAACN,KAAK,CAAC,EAAEO,CAAC,IAAIA,CAAC,CAACC,UAAU,CAAC,CAAC,CAAC,CAAC;UACtE5F,CAAC,CAAC6F,WAAW,CAACzB,IAAI,EAAEmB,WAAW,CAAC;UAChC7C,cAAc,CAAC8B,OAAO,GAAGc,WAAW,IAAI,CAAC,CAAC;;UAE1C;UACA,IAAI1D,iBAAiB,CAACkE,MAAM,GAAG,CAAC,EAAE;YAChC,MAAMC,wBAAwB,CAAC,CAAC;UAClC;QACF,CAAC,CAAC,OAAO7B,KAAK,EAAE;UACdC,OAAO,CAACD,KAAK,CAAC,gCAAgC,EAAEA,KAAK,CAAC;QACxD;MACF,CAAC,CAAC;MAEFQ,MAAM,CAACM,EAAE,CAAC,iBAAiB,EAAE,CAAC;QAAEgB,MAAM;QAAEV,WAAW;QAAEW,gBAAgB;QAAEC,MAAM;QAAEC;MAAS,CAAC,KAAK;QAC5F,IAAI;UACF;UACA,IAAIA,QAAQ,KAAK1D,WAAW,CAAC+B,OAAO,EAAE;YACpC;UACF;UAEA,MAAM4B,YAAY,GAAGZ,UAAU,CAACC,IAAI,CAACC,IAAI,CAACM,MAAM,CAAC,EAAEL,CAAC,IAAIA,CAAC,CAACC,UAAU,CAAC,CAAC,CAAC,CAAC;UACxE5F,CAAC,CAAC6F,WAAW,CAACzB,IAAI,EAAEgC,YAAY,CAAC;UACjC1D,cAAc,CAAC8B,OAAO,GAAGc,WAAW,IAAI,CAAC,CAAC;QAC5C,CAAC,CAAC,OAAOpB,KAAK,EAAE;UACdC,OAAO,CAACD,KAAK,CAAC,wBAAwB,EAAEA,KAAK,CAAC;QAChD;MACF,CAAC,CAAC;MAEFQ,MAAM,CAACM,EAAE,CAAC,YAAY,EAAE,CAAC;QAAEmB,QAAQ;QAAEb,WAAW;QAAEW;MAAiB,CAAC,KAAK;QACvE;QACApE,oBAAoB,CAACwE,IAAI,IAAIA,IAAI,CAACC,MAAM,CAACC,EAAE,IAAIA,EAAE,CAACJ,QAAQ,KAAKA,QAAQ,CAAC,CAAC;QACzEzD,cAAc,CAAC8B,OAAO,GAAGc,WAAW,IAAI,CAAC,CAAC;MAC5C,CAAC,CAAC;MAEFZ,MAAM,CAACM,EAAE,CAAC,eAAe,EAAE,CAAC;QAAEkB,MAAM;QAAEM,QAAQ;QAAEC;MAAO,CAAC,KAAK;QAC3D9E,WAAW,CAAC0E,IAAI,KAAK;UACnB,GAAGA,IAAI;UACP,CAACH,MAAM,GAAG;YAAE,GAAGG,IAAI,CAACH,MAAM,CAAC;YAAEO,MAAM;YAAED;UAAS;QAChD,CAAC,CAAC,CAAC;MACL,CAAC,CAAC;MAEF9B,MAAM,CAACM,EAAE,CAAC,aAAa,EAAE,CAAC;QAAEkB,MAAM;QAAEM,QAAQ;QAAEE;MAAM,CAAC,KAAK;QACxD/E,WAAW,CAAC0E,IAAI,KAAK;UACnB,GAAGA,IAAI;UACP,CAACH,MAAM,GAAG;YAAEM,QAAQ;YAAEE,KAAK;YAAED,MAAM,EAAE;UAAK;QAC5C,CAAC,CAAC,CAAC;QACHvG,KAAK,CAACyG,IAAI,CAAC,GAAGH,QAAQ,SAAS,CAAC;MAClC,CAAC,CAAC;MAEF9B,MAAM,CAACM,EAAE,CAAC,WAAW,EAAE,CAAC;QAAEkB,MAAM;QAAEM;MAAS,CAAC,KAAK;QAC/C7E,WAAW,CAAC0E,IAAI,IAAI;UAClB,MAAMO,OAAO,GAAG;YAAE,GAAGP;UAAK,CAAC;UAC3B,OAAOO,OAAO,CAACV,MAAM,CAAC;UACtB,OAAOU,OAAO;QAChB,CAAC,CAAC;QACF1G,KAAK,CAACyG,IAAI,CAAC,GAAGH,QAAQ,OAAO,CAAC;MAChC,CAAC,CAAC;MAEF9B,MAAM,CAACM,EAAE,CAAC,iBAAiB,EAAE,CAAC;QAAE6B;MAAM,CAAC,KAAK;QAC1C,MAAMC,WAAW,GAAG,CAAC,CAAC;QACtBD,KAAK,CAACE,OAAO,CAAC/C,IAAI,IAAI;UACpB8C,WAAW,CAAC9C,IAAI,CAACkC,MAAM,CAAC,GAAGlC,IAAI;QACjC,CAAC,CAAC;QACFrC,WAAW,CAACmF,WAAW,CAAC;MAC1B,CAAC,CAAC;MAEFpC,MAAM,CAACM,EAAE,CAAC,OAAO,EAAE,CAAC;QAAEgC;MAAQ,CAAC,KAAK;QAClC9G,KAAK,CAACgE,KAAK,CAAC8C,OAAO,CAAC;QACpB,IAAIA,OAAO,CAACC,QAAQ,CAAC,eAAe,CAAC,IAAID,OAAO,CAACC,QAAQ,CAAC,WAAW,CAAC,EAAE;UACtElG,QAAQ,CAAC,YAAY,CAAC;QACxB;MACF,CAAC,CAAC;;MAEF;MACAuD,KAAK,CAAC4C,OAAO,CAAEC,KAAK,IAAK;QACvB,IAAI,CAACxE,gBAAgB,CAAC6B,OAAO,EAAE;UAC7B,MAAM4C,IAAI,GAAG9C,KAAK,CAAC+C,QAAQ,CAAC,CAAC;UAC7B5F,UAAU,CAAC2F,IAAI,CAAC;UAChB;UACA,IAAIpG,SAAS,CAACwD,OAAO,EAAE;YACrB,MAAM8C,QAAQ,GAAGtG,SAAS,CAACwD,OAAO;YAClC,MAAM+C,SAAS,GAAGC,IAAI,CAACC,GAAG,CAACH,QAAQ,CAAC/E,cAAc,EAAE6E,IAAI,CAACtB,MAAM,CAAC;YAChEwB,QAAQ,CAACI,iBAAiB,CAACH,SAAS,EAAEA,SAAS,CAAC;UAClD;QACF;QACA5E,gBAAgB,CAAC6B,OAAO,GAAG,KAAK;MAClC,CAAC,CAAC;;MAEF;MACA/C,UAAU,CAAC6C,KAAK,CAAC+C,QAAQ,CAAC,CAAC,CAAC;IAE9B,CAAC,CAAC,OAAOnD,KAAK,EAAE;MACdC,OAAO,CAACD,KAAK,CAAC,uBAAuB,EAAEA,KAAK,CAAC;MAC7ChE,KAAK,CAACgE,KAAK,CAAC,6BAA6B,CAAC;IAC5C;EACF,CAAC;EAED,MAAM6B,wBAAwB,GAAG,MAAAA,CAAA,KAAY;IAAA,IAAA4B,kBAAA;IAC3C,IAAI,GAAAA,kBAAA,GAAC1G,SAAS,CAACuD,OAAO,cAAAmD,kBAAA,eAAjBA,kBAAA,CAAmBvG,SAAS,KAAIQ,iBAAiB,CAACkE,MAAM,KAAK,CAAC,EAAE;MACnE;IACF;IAEA,MAAM8B,UAAU,GAAG,CAAC,GAAGhG,iBAAiB,CAAC;IACzCC,oBAAoB,CAAC,EAAE,CAAC;IAExB,KAAK,MAAM0E,EAAE,IAAIqB,UAAU,EAAE;MAC3B,IAAI;QACF3G,SAAS,CAACuD,OAAO,CAACU,IAAI,CAAC,iBAAiB,EAAE;UACxCpE,UAAU;UACVkF,MAAM,EAAEO,EAAE,CAACP,MAAM;UACjBV,WAAW,EAAEiB,EAAE,CAACjB,WAAW;UAC3Ba,QAAQ,EAAEI,EAAE,CAACJ;QACf,CAAC,CAAC;MACJ,CAAC,CAAC,OAAOjC,KAAK,EAAE;QACdC,OAAO,CAACD,KAAK,CAAC,kCAAkC,EAAEA,KAAK,CAAC;QACxDrC,oBAAoB,CAACwE,IAAI,IAAI,CAAC,GAAGA,IAAI,EAAEE,EAAE,CAAC,CAAC;MAC7C;IACF;EACF,CAAC;EAED,MAAMsB,gBAAgB,GAAGjI,WAAW,CAAEkI,CAAC,IAAK;IAAA,IAAAC,mBAAA;IAC1C,IAAI,CAAC5G,QAAQ,CAACqD,OAAO,IAAI,CAACtD,OAAO,CAACsD,OAAO,EAAE;IAE3C,MAAMwD,QAAQ,GAAGF,CAAC,CAACG,MAAM,CAACC,KAAK;IAC/B,MAAMC,QAAQ,GAAGhH,QAAQ,CAACqD,OAAO,CAAC6C,QAAQ,CAAC,CAAC;IAE5C,IAAIW,QAAQ,KAAKG,QAAQ,EAAE;;IAE3B;IACAxF,gBAAgB,CAAC6B,OAAO,GAAG,IAAI;;IAE/B;IACA,MAAM4D,IAAI,GAAGC,aAAa,CAACF,QAAQ,EAAEH,QAAQ,CAAC;;IAE9C;IACA,IAAII,IAAI,CAACE,IAAI,KAAK,QAAQ,EAAE;MAC1BnH,QAAQ,CAACqD,OAAO,CAAC+D,MAAM,CAACH,IAAI,CAACI,KAAK,EAAEJ,IAAI,CAAChB,IAAI,CAAC;IAChD,CAAC,MAAM,IAAIgB,IAAI,CAACE,IAAI,KAAK,QAAQ,EAAE;MACjCnH,QAAQ,CAACqD,OAAO,CAACiE,MAAM,CAACL,IAAI,CAACI,KAAK,EAAEJ,IAAI,CAACtC,MAAM,CAAC;IAClD,CAAC,MAAM,IAAIsC,IAAI,CAACE,IAAI,KAAK,SAAS,EAAE;MAClCnH,QAAQ,CAACqD,OAAO,CAACiE,MAAM,CAACL,IAAI,CAACI,KAAK,EAAEJ,IAAI,CAACtC,MAAM,CAAC;MAChD3E,QAAQ,CAACqD,OAAO,CAAC+D,MAAM,CAACH,IAAI,CAACI,KAAK,EAAEJ,IAAI,CAACG,MAAM,CAAC;IAClD;;IAEA;IACA,MAAMvC,MAAM,GAAGhG,CAAC,CAAC0I,mBAAmB,CAACxH,OAAO,CAACsD,OAAO,CAAC;IACrD,MAAM2B,QAAQ,GAAG,EAAE1D,WAAW,CAAC+B,OAAO;IACtC,MAAMmE,YAAY,GAAGC,IAAI,CAACC,MAAM,CAACC,YAAY,CAAC,GAAG9C,MAAM,CAAC,CAAC;IAEzD,KAAA+B,mBAAA,GAAI9G,SAAS,CAACuD,OAAO,cAAAuD,mBAAA,eAAjBA,mBAAA,CAAmB3G,SAAS,EAAE;MAChCH,SAAS,CAACuD,OAAO,CAACU,IAAI,CAAC,iBAAiB,EAAE;QACxCpE,UAAU;QACVkF,MAAM,EAAE2C,YAAY;QACpBrD,WAAW,EAAE5C,cAAc,CAAC8B,OAAO;QACnC2B;MACF,CAAC,CAAC;;MAEF;MACAtE,oBAAoB,CAACwE,IAAI,IAAI,CAAC,GAAGA,IAAI,EAAE;QACrCF,QAAQ;QACRH,MAAM,EAAE2C,YAAY;QACpBrD,WAAW,EAAE5C,cAAc,CAAC8B,OAAO;QACnCuE,SAAS,EAAEC,IAAI,CAACC,GAAG,CAAC;MACtB,CAAC,CAAC,CAAC;IACL,CAAC,MAAM;MACL;MACApH,oBAAoB,CAACwE,IAAI,IAAI,CAAC,GAAGA,IAAI,EAAE;QACrCF,QAAQ;QACRH,MAAM,EAAE2C,YAAY;QACpBrD,WAAW,EAAE5C,cAAc,CAAC8B,OAAO;QACnCuE,SAAS,EAAEC,IAAI,CAACC,GAAG,CAAC;MACtB,CAAC,CAAC,CAAC;MACHlH,YAAY,CAAC,IAAI,CAAC;IACpB;EACF,CAAC,EAAE,CAACjB,UAAU,CAAC,CAAC;EAEhB,MAAMuH,aAAa,GAAGA,CAACa,OAAO,EAAEC,OAAO,KAAK;IAC1C,IAAIC,CAAC,GAAG,CAAC;IACT,OAAOA,CAAC,GAAGF,OAAO,CAACpD,MAAM,IAAIsD,CAAC,GAAGD,OAAO,CAACrD,MAAM,IAAIoD,OAAO,CAACE,CAAC,CAAC,KAAKD,OAAO,CAACC,CAAC,CAAC,EAAE;MAC5EA,CAAC,EAAE;IACL;IAEA,IAAIC,CAAC,GAAGH,OAAO,CAACpD,MAAM,GAAG,CAAC;IAC1B,IAAIwD,CAAC,GAAGH,OAAO,CAACrD,MAAM,GAAG,CAAC;IAC1B,OAAOuD,CAAC,IAAID,CAAC,IAAIE,CAAC,IAAIF,CAAC,IAAIF,OAAO,CAACG,CAAC,CAAC,KAAKF,OAAO,CAACG,CAAC,CAAC,EAAE;MACpDD,CAAC,EAAE;MACHC,CAAC,EAAE;IACL;IAEA,IAAIF,CAAC,GAAGC,CAAC,EAAE;MACT;MACA,OAAO;QAAEf,IAAI,EAAE,QAAQ;QAAEE,KAAK,EAAEY,CAAC;QAAEhC,IAAI,EAAE+B,OAAO,CAACI,SAAS,CAACH,CAAC,EAAEE,CAAC,GAAG,CAAC;MAAE,CAAC;IACxE,CAAC,MAAM,IAAIF,CAAC,GAAGE,CAAC,EAAE;MAChB;MACA,OAAO;QAAEhB,IAAI,EAAE,QAAQ;QAAEE,KAAK,EAAEY,CAAC;QAAEtD,MAAM,EAAEuD,CAAC,GAAGD,CAAC,GAAG;MAAE,CAAC;IACxD,CAAC,MAAM;MACL;MACA,OAAO;QAAEd,IAAI,EAAE,SAAS;QAAEE,KAAK,EAAEY,CAAC;QAAEtD,MAAM,EAAEuD,CAAC,GAAGD,CAAC,GAAG,CAAC;QAAEb,MAAM,EAAEY,OAAO,CAACI,SAAS,CAACH,CAAC,EAAEE,CAAC,GAAG,CAAC;MAAE,CAAC;IAC9F;EACF,CAAC;EAED,MAAME,kBAAkB,GAAG5J,WAAW,CAAC,MAAM;IAAA,IAAA6J,mBAAA;IAC3C,IAAI,CAACzI,SAAS,CAACwD,OAAO,EAAE;IAExB,MAAM8C,QAAQ,GAAGtG,SAAS,CAACwD,OAAO;IAClC,MAAMlC,QAAQ,GAAGgF,QAAQ,CAAC/E,cAAc;IACxC,MAAMA,cAAc,GAAG+E,QAAQ,CAAC/E,cAAc;IAC9C,MAAMC,YAAY,GAAG8E,QAAQ,CAAC9E,YAAY;;IAE1C;IACA,MAAMyG,GAAG,GAAGD,IAAI,CAACC,GAAG,CAAC,CAAC;IACtB,IAAIA,GAAG,GAAG7G,iBAAiB,CAACoC,OAAO,GAAG,EAAE,EAAE;MACxC;IACF;IACApC,iBAAiB,CAACoC,OAAO,GAAGyE,GAAG;;IAE/B;IACA,IACE3G,QAAQ,KAAKD,aAAa,CAACmC,OAAO,CAAClC,QAAQ,IAC3CC,cAAc,KAAKF,aAAa,CAACmC,OAAO,CAACjC,cAAc,IACvDC,YAAY,KAAKH,aAAa,CAACmC,OAAO,CAAChC,YAAY,EACnD;MACA;IACF;IAEAH,aAAa,CAACmC,OAAO,GAAG;MAAElC,QAAQ;MAAEC,cAAc;MAAEC;IAAa,CAAC;IAElE,KAAAiH,mBAAA,GAAIxI,SAAS,CAACuD,OAAO,cAAAiF,mBAAA,eAAjBA,mBAAA,CAAmBrI,SAAS,EAAE;MAChCH,SAAS,CAACuD,OAAO,CAACU,IAAI,CAAC,eAAe,EAAE;QACtCpE,UAAU;QACV2F,MAAM,EAAE;UAAEnE,QAAQ;UAAEC,cAAc;UAAEC;QAAa;MACnD,CAAC,CAAC;IACJ;EACF,CAAC,EAAE,CAAC1B,UAAU,CAAC,CAAC;EAEhB,MAAMgC,OAAO,GAAGA,CAAA,KAAM;IACpB,IAAI7B,SAAS,CAACuD,OAAO,EAAE;MACrBvD,SAAS,CAACuD,OAAO,CAACkF,UAAU,CAAC,CAAC;MAC9BzI,SAAS,CAACuD,OAAO,GAAG,IAAI;IAC1B;IACA,IAAItD,OAAO,CAACsD,OAAO,EAAE;MACnBtD,OAAO,CAACsD,OAAO,CAACmF,OAAO,CAAC,CAAC;MACzBzI,OAAO,CAACsD,OAAO,GAAG,IAAI;IACxB;EACF,CAAC;EAED,oBACEnE,OAAA;IAAKuJ,SAAS,EAAC,kBAAkB;IAAAC,QAAA,gBAC/BxJ,OAAA;MAAQuJ,SAAS,EAAC,eAAe;MAAAC,QAAA,gBAC/BxJ,OAAA;QAAQyJ,OAAO,EAAEA,CAAA,KAAM/I,QAAQ,CAAC,YAAY,CAAE;QAAC6I,SAAS,EAAC,UAAU;QAAAC,QAAA,EAAC;MAEpE;QAAAE,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAQ,CAAC,eACT7J,OAAA;QAAAwJ,QAAA,EAAKvI;MAAa;QAAAyI,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAK,CAAC,eACxB7J,OAAA;QAAKuJ,SAAS,EAAC,gBAAgB;QAAAC,QAAA,eAC7BxJ,OAAA;UAAQyJ,OAAO,EAAEA,CAAA,KAAM7H,eAAe,CAAC,IAAI,CAAE;UAAC2H,SAAS,EAAC,cAAc;UAAAC,QAAA,EAAC;QAEvE;UAAAE,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAQ;MAAC;QAAAH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACN,CAAC,eACN7J,OAAA;QAAKuJ,SAAS,EAAC,eAAe;QAAAC,QAAA,gBAC5BxJ,OAAA;UAAMuJ,SAAS,EAAE,oBAAoBxI,SAAS,GAAG,WAAW,GAAG,cAAc,EAAG;UAAAyI,QAAA,EAC7EzI,SAAS,GAAG,aAAa,GAAG;QAAgB;UAAA2I,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OACzC,CAAC,EACNC,MAAM,CAACC,IAAI,CAAC1I,QAAQ,CAAC,CAACoE,MAAM,GAAG,CAAC,iBAC/BzF,OAAA;UAAKuJ,SAAS,EAAC,qBAAqB;UAAAC,QAAA,EACjCM,MAAM,CAACE,OAAO,CAAC3I,QAAQ,CAAC,CAAC4I,GAAG,CAAC,CAAC,CAACpE,MAAM,EAAEhD,IAAI,CAAC;YAAA,IAAAqH,cAAA,EAAAC,eAAA;YAAA,oBAC3CnK,OAAA;cAEEuJ,SAAS,EAAC,gBAAgB;cAC1Ba,KAAK,EAAE;gBAAEC,WAAW,EAAExH,IAAI,CAACwD,KAAK,IAAI;cAAU,CAAE;cAChDtD,KAAK,EAAEF,IAAI,CAACsD,QAAS;cAAAqD,QAAA,EAEpB,EAAAU,cAAA,GAAArH,IAAI,CAACsD,QAAQ,cAAA+D,cAAA,wBAAAC,eAAA,GAAbD,cAAA,CAAgB,CAAC,CAAC,cAAAC,eAAA,uBAAlBA,eAAA,CAAoBG,WAAW,CAAC,CAAC,KAAI;YAAG,GALpCzE,MAAM;cAAA6D,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAMP,CAAC;UAAA,CACR;QAAC;UAAAH,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OACC,CACN;MAAA;QAAAH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACE,CAAC;IAAA;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACA,CAAC,eAET7J,OAAA;MAAKuJ,SAAS,EAAC,gBAAgB;MAAAC,QAAA,eAC7BxJ,OAAA;QACEuK,GAAG,EAAE5J,SAAU;QACfkH,KAAK,EAAE1G,OAAQ;QACfqJ,QAAQ,EAAEhD,gBAAiB;QAC3BiD,QAAQ,EAAEtB,kBAAmB;QAC7BuB,OAAO,EAAEvB,kBAAmB;QAC5BwB,SAAS,EAAExB,kBAAmB;QAC9BI,SAAS,EAAC,iBAAiB;QAC3BqB,WAAW,EAAC,iBAAiB;QAC7BC,UAAU,EAAE;MAAM;QAAAnB,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACnB;IAAC;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACC,CAAC,EAELpI,SAAS,IAAIF,iBAAiB,CAACkE,MAAM,GAAG,CAAC,iBACxCzF,OAAA;MAAKuJ,SAAS,EAAC,mBAAmB;MAAAC,QAAA,GAC/BjI,iBAAiB,CAACkE,MAAM,EAAC,iDAC5B;IAAA;MAAAiE,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAAK,CACN,eAED7J,OAAA,CAACF,gBAAgB;MACfW,UAAU,EAAEA,UAAW;MACvBqK,MAAM,EAAEnJ,YAAa;MACrBoJ,OAAO,EAAEA,CAAA,KAAMnJ,eAAe,CAAC,KAAK,CAAE;MACtCC,QAAQ,EAAEA,QAAS;MACnBmJ,QAAQ,EAAEzI;IAAkB;MAAAmH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAC7B,CAAC;EAAA;IAAAH,QAAA,EAAAC,YAAA;IAAAC,UAAA;IAAAC,YAAA;EAAA,OACC,CAAC;AAEV;AAACrJ,EAAA,CA/YQD,MAAM;EAAA,QACUf,SAAS,EACfC,WAAW;AAAA;AAAAwL,EAAA,GAFrB1K,MAAM;AAiZf,eAAeA,MAAM;AAAC,IAAA0K,EAAA;AAAAC,YAAA,CAAAD,EAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}